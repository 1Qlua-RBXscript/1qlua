
local LibraryUrl = "https://raw.githubusercontent.com/1Qlua-RBXscript/1qlua/refs/heads/main/labar"
loadstring(game:HttpGet(('https://raw.githubusercontent.com/1Qlua-RBXscript/1qlua/refs/heads/main/Music/animezui'),true))()
local Success, Library = pcall(function()
    return loadstring(game:HttpGet(LibraryUrl))()
end)

if not Success or not Library then 
    return warn("Error loading UI library!") 
end

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

Library:Watermark("| >ᴗ< | ♡1Qlua♡ (Хаб) | >ᴗ< |  v12 | >ᴗ< ")
local Window = Library:Window("| 1Qlua ♡ Хаб |")

-- функций
-- музыка
-- Настройки музыки
local settings = {
    SoundFile = "cat.mp3",
    SoundUrl = "https://cdn.discordapp.com/attachments/1374346480130719744/1455053866943910164/the_living_tombstone_-_Cats_slowedreverb_-_GemanTyoma_youtube.mp3?ex=69535403&is=69520283&hm=707c5099eda0ed08a13a1c43c222560b62795aea96d8ec440b2deadf2111616c&",
    DefaultVolume = 0.5,
    LoopEnabled = true,
    AutoPlay = true,
}


-- Переменные для хранения состояния
local sound = nil
local isMusicLoaded = false
local isPlaying = false
local currentVolume = 0.5
local isLooped = true
local musicToggle = nil

-- Функция загрузки и инициализации музыки
local function initializeMusic()
    if not isMusicLoaded then
        -- Проверяем наличие файла и загружаем если нужно
        if not isfile(settings.SoundFile) then
            writefile(settings.SoundFile, game:HttpGet(settings.SoundUrl))
        end
        
        -- Ждем загрузки персонажа
        local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local rootPart = character:WaitForChild("HumanoidRootPart")
        
        -- Создаем звуковой объект
        sound = Instance.new("Sound")
        sound.SoundId = getcustomasset(settings.SoundFile)
        sound.Volume = currentVolume
        sound.Looped = isLooped
        sound.Parent = rootPart
        
        isMusicLoaded = true
        return true
    end
    return false
end

-- Функции управления
local function playMusic()
    if sound and not sound.IsPlaying then
        sound:Play()
        isPlaying = true
        return true
    end
    return false
end

local function stopMusic()
    if sound and sound.IsPlaying then
        sound:Stop()
        isPlaying = false
        return true
    end
    return false
end

local function toggleMusic()
    if sound then
        if sound.IsPlaying then
            sound:Stop()
            isPlaying = false
            return false
        else
            sound:Play()
            isPlaying = true
            return true
        end
    end
    return false
end

local function setVolume(newVolume)
    currentVolume = newVolume
    if sound then
        sound.Volume = currentVolume
    end
end


-- флинг
local walkflinging = false
local antifling = nil
local function enableWalkFling()
    if walkflinging then return end
    walkflinging = true
    task.spawn(function()
        local RunService = game:GetService("RunService")
        local LocalPlayer = game.Players.LocalPlayer
        
        while walkflinging do
            RunService.Heartbeat:Wait()
            local char = LocalPlayer.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")
            
            if root then
                local vel = root.Velocity
                root.Velocity = vel * 10000 + Vector3.new(0, 10000, 0)
                
                RunService.RenderStepped:Wait()
                if root then
                    root.Velocity = vel
                end
            end
        end
    end)
end
local function disableWalkFling()
    walkflinging = false
end
local function enableAntiFling()
    if antifling then
        antifling:Disconnect()
    end
    
    antifling = game:GetService("RunService").Stepped:Connect(function()
        for _, player in pairs(game:GetService("Players"):GetPlayers()) do
            if player ~= game.Players.LocalPlayer and player.Character then
                for _, v in pairs(player.Character:GetDescendants()) do
                    if v:IsA("BasePart") then
                        v.CanCollide = false
                    end
                end
            end
        end
    end)
end
local function disableAntiFling()
    if antifling then
        antifling:Disconnect()
        antifling = nil
    end
end
-- ТУТ НАЧАЛО ДРУГОЙ ФУНКЦИИ
-- это если что игроки
local SelectedPlayer = nil
local PlayerESP = {}
local Spectating = false
local OriginalCameraSubject = nil
local ESPEnabled = false


local AvatarCache = {}

local PlayerSelectionGUI = Instance.new("ScreenGui")
PlayerSelectionGUI.Name = "PlayerSelector"
PlayerSelectionGUI.ResetOnSpawn = false
PlayerSelectionGUI.ZIndexBehavior = Enum.ZIndexBehavior.Global  
if syn then
    PlayerSelectionGUI.Parent = syn.protect_gui and syn.protect_gui(PlayerSelectionGUI) or game:GetService("CoreGui")
else
    PlayerSelectionGUI.Parent = game:GetService("CoreGui")
end

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 350, 0, 450)
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -225)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Visible = false
MainFrame.ZIndex = 100 
MainFrame.Parent = PlayerSelectionGUI

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 6)
UICorner.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Title.Text = "Выберите игрока"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.Gotham
Title.TextSize = 16
Title.ZIndex = 101
Title.Parent = MainFrame

local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.Text = "X"
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 14
CloseButton.ZIndex = 101
CloseButton.Parent = MainFrame

local SearchBox = Instance.new("TextBox")
SearchBox.Size = UDim2.new(1, -20, 0, 30)
SearchBox.Position = UDim2.new(0, 10, 0, 50)
SearchBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
SearchBox.TextColor3 = Color3.fromRGB(255, 255, 255)
SearchBox.PlaceholderText = "Поиск игрока..."
SearchBox.Font = Enum.Font.Gotham
SearchBox.TextSize = 14
SearchBox.Text = "" 
SearchBox.ZIndex = 101
SearchBox.Parent = MainFrame

local SearchBoxCorner = Instance.new("UICorner")
SearchBoxCorner.CornerRadius = UDim.new(0, 4)
SearchBoxCorner.Parent = SearchBox
local PlayersFrame = Instance.new("ScrollingFrame")
PlayersFrame.Size = UDim2.new(1, -20, 1, -100)
PlayersFrame.Position = UDim2.new(0, 10, 0, 90)
PlayersFrame.BackgroundTransparency = 1
PlayersFrame.ScrollBarThickness = 5
PlayersFrame.ZIndex = 101
PlayersFrame.Parent = MainFrame
local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 5)
UIListLayout.Parent = PlayersFrame
local function GetPlayerAvatar(player)
    local userId = player.UserId
    if AvatarCache[userId] then
        return AvatarCache[userId]
    end
    local success, result = pcall(function()
        return game:GetService("Players"):GetUserThumbnailAsync(userId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
    end)
    if success and result then
        AvatarCache[userId] = result
        return result
    end
    return "rbxasset://textures/ui/GuiImagePlaceholder.png"
end

local function CreatePlayerButton(player)
    local PlayerButton = Instance.new("Frame")
    PlayerButton.Size = UDim2.new(1, 0, 0, 50)
    PlayerButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    PlayerButton.ZIndex = 102
    PlayerButton.Parent = PlayersFrame
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 4)
    ButtonCorner.Parent = PlayerButton
    local Avatar = Instance.new("ImageLabel")
    Avatar.Size = UDim2.new(0, 40, 0, 40)
    Avatar.Position = UDim2.new(0, 5, 0.5, -20)
    Avatar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Avatar.Image = GetPlayerAvatar(player)
    Avatar.ZIndex = 103
    Avatar.Parent = PlayerButton
    local AvatarCorner = Instance.new("UICorner")
    AvatarCorner.CornerRadius = UDim.new(0, 4)
    AvatarCorner.Parent = Avatar
    local PlayerName = Instance.new("TextLabel")
    PlayerName.Size = UDim2.new(1, -55, 1, 0)
    PlayerName.Position = UDim2.new(0, 50, 0, 0)
    PlayerName.BackgroundTransparency = 1
    PlayerName.Text = player.Name
    PlayerName.TextColor3 = Color3.fromRGB(255, 255, 255)
    PlayerName.Font = Enum.Font.Gotham
    PlayerName.TextSize = 14
    PlayerName.TextXAlignment = Enum.TextXAlignment.Left
    PlayerName.ZIndex = 103
    PlayerName.Parent = PlayerButton
    local SelectButton = Instance.new("TextButton")
    SelectButton.Size = UDim2.new(1, 0, 1, 0)
    SelectButton.BackgroundTransparency = 1
    SelectButton.Text = ""
    SelectButton.ZIndex = 104
    SelectButton.Parent = PlayerButton
    
    SelectButton.MouseButton1Click:Connect(function()
        SelectedPlayer = player
        MainFrame.Visible = false
    end)
    
    return PlayerButton
end

local function UpdatePlayerList()
    for _, child in pairs(PlayersFrame:GetChildren()) do
        if child:IsA("Frame") then
            child:Destroy()
        end
    end
    
    local searchText = string.lower(SearchBox.Text)
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local playerName = string.lower(player.Name)
            if searchText == "" or string.find(playerName, searchText, 1, true) then
                CreatePlayerButton(player)
            end
        end
    end
end

local function TeleportToPlayer()
    if SelectedPlayer and SelectedPlayer.Character and SelectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            LocalPlayer.Character.HumanoidRootPart.CFrame = SelectedPlayer.Character.HumanoidRootPart.CFrame
        end
    end
end

local function ToggleESP(state)
    ESPEnabled = state
    if not state then
        for _, esp in pairs(PlayerESP) do
            if esp then
                esp:Destroy()
            end
        end
        PlayerESP = {}
    elseif SelectedPlayer then
        if PlayerESP[SelectedPlayer] then
            PlayerESP[SelectedPlayer]:Destroy()
            PlayerESP[SelectedPlayer] = nil
        end
        
        if SelectedPlayer.Character then
            local highlight = Instance.new("Highlight")
            highlight.OutlineTransparency = 0
            highlight.FillTransparency = 0.5
            highlight.FillColor = Color3.fromRGB(255, 0, 0)
            highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
            highlight.Parent = SelectedPlayer.Character
            PlayerESP[SelectedPlayer] = highlight
        end
    end
end

local function ToggleSpectate(state)
    Spectating = state
    if state and SelectedPlayer and SelectedPlayer.Character then
        OriginalCameraSubject = Camera.CameraSubject
        Camera.CameraSubject = SelectedPlayer.Character:FindFirstChildOfClass("Humanoid")
    else
        if OriginalCameraSubject then
            Camera.CameraSubject = OriginalCameraSubject
        end
    end
end

local function ResetCamera()
    if LocalPlayer.Character then
        Camera.CameraSubject = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    end
    Spectating = false
end

--функции

local NoClipEnabled = false
local NoClipConnection = nil
local FullbrightEnabled = false
local OriginalLighting = nil

local function setupNoClip()
    if NoClipConnection then
        NoClipConnection:Disconnect()
        NoClipConnection = nil
    end
    NoClipConnection = RunService.Stepped:Connect(function()
        if NoClipEnabled and LocalPlayer.Character then
            for _, part in ipairs(LocalPlayer.Character:GetDescendants()) do
                if part:IsA("BasePart") and part.CanCollide then
                    part.CanCollide = false
                end
            end
        end
    end)
end

local function setFullbright(enabled)
    local Lighting = game:GetService("Lighting")
    if enabled then
        OriginalLighting = {
            Ambient = Lighting.Ambient,
            Brightness = Lighting.Brightness,
            GlobalShadows = Lighting.GlobalShadows,
            OutdoorAmbient = Lighting.OutdoorAmbient
        }
        Lighting.Ambient = Color3.new(1, 1, 1)
        Lighting.Brightness = 2
        Lighting.GlobalShadows = false
        Lighting.OutdoorAmbient = Color3.new(1, 1, 1)
    else
        if OriginalLighting then
            Lighting.Ambient = OriginalLighting.Ambient
            Lighting.Brightness = OriginalLighting.Brightness
            Lighting.GlobalShadows = OriginalLighting.GlobalShadows
            Lighting.OutdoorAmbient = OriginalLighting.OutdoorAmbient
        end
    end
end

-- скорость
local walkSpeedValue = 16
local jumpHeightValue = 7.2
local fovValue = 70

local speedSliderValue = 16
local jumpSliderValue = 50
local fovSliderValue = 70

local function updateSpeed(value)
    speedSliderValue = value
end

local function updateJump(value)
    jumpSliderValue = value
end

local function updateFOV(value)
    fovSliderValue = value
end

local updateConnection
local function startUpdating()
    if updateConnection then
        updateConnection:Disconnect()
    end
    
    updateConnection = game:GetService("RunService").Heartbeat:Connect(function()
        if walkSpeedValue ~= speedSliderValue then
            walkSpeedValue = speedSliderValue
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.WalkSpeed = walkSpeedValue
            end
        end
        local newJumpHeight = jumpSliderValue / 7
        if newJumpHeight < 0.5 then newJumpHeight = 0.5 end
        
        if jumpHeightValue ~= newJumpHeight then
            jumpHeightValue = newJumpHeight
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.JumpHeight = jumpHeightValue
            end
        end
        if fovValue ~= fovSliderValue then
            fovValue = fovSliderValue
            local camera = workspace.CurrentCamera
            if camera then
                camera.FieldOfView = fovValue
            end
        end
    end)
end

-- tab
Window:Section("╰┈> Основной")
local MainTab = Window:Tab("♡ Игрок ♡", "eye") 
Window:Section("★ | Настройки")
local SettingsTab = Window:Tab("☆ Настройки", "7733771472" )

local GeneralPage = MainTab:SubTab("♡ Основной ♡")
local ScriptPage = MainTab:SubTab("❀ Скрипты ❀")

-- Подвкладки
local InterfacePage = SettingsTab:SubTab("Интерфейс")
local GamePage = SettingsTab:SubTab("Игра")
local MusicPage = SettingsTab:SubTab("Музыка")
local PerformancePage = SettingsTab:SubTab("Производительность")
local SecurityPage = SettingsTab:SubTab("Безопасность")

local FarmGroup = GeneralPage:Groupbox("╰┈> Основное ♡", "Left", "camera")
local ExtraGroup = GeneralPage:Groupbox("╰┈> Функции ♡", "Right", "eye")
local TpGrouo = GeneralPage:Groupbox("╰┈> Игроки ♡", "Left", "camera")
local FilngGroup = GeneralPage:Groupbox("╰┈> Filng ♡", "Right", "camera")
local MusicGroup = MusicPage:Groupbox("Управление", "Left")
local InfGroup = MusicPage:Groupbox("Текуший трек", "Right")


local PlayerGroup = ScriptPage:Groupbox("╰┈> Игрок♡", "Left", "camera")
local ScriptsGroup = ScriptPage:Groupbox("╰┈> Скрипты♡", "Right", "eye")


FarmGroup:AddSlider({
    Title = "♡Скорость⤵ \nпередвижения♡",
    Min = 0,
    Max = 150,
    Default = 16,
    Suffix = " ❀studs❀",
    Callback = updateSpeed
})

FarmGroup:AddSlider({
    Title = "♡Высота- \n -прыжка♡",
    Min = 0,
    Max = 500,
    Default = 50,
    Suffix = " ❀сила❀",
    Callback = updateJump
})

FarmGroup:AddSlider({
    Title = "♡Поле- \n-зрения♡",
    Min = 0,
    Max = 120,
    Default = 70,
    Suffix = " ❀градусов❀",
    Callback = updateFOV
})

startUpdating()

game.Players.LocalPlayer.CharacterAdded:Connect(function(character)
    task.wait(0.5)
    local humanoid = character:WaitForChild("Humanoid")
    if humanoid then
        humanoid.WalkSpeed = walkSpeedValue
        humanoid.JumpHeight = jumpHeightValue
    end
end)

if game.Players.LocalPlayer.Character then
    local character = game.Players.LocalPlayer.Character
    local humanoid = character:WaitForChild("Humanoid", 1)
    if humanoid then
        humanoid.WalkSpeed = walkSpeedValue
        humanoid.JumpHeight = jumpHeightValue
    end
end

if workspace.CurrentCamera then
    workspace.CurrentCamera.FieldOfView = fovValue
end

game:GetService("UserInputService").WindowFocused:Connect(function()
    if not updateConnection then return end
    if not updateConnection.Connected then
        startUpdating()
    end
end)

ExtraGroup:AddToggle({
    Title = "˗ˋˏ♡ˎˊ˗NoClip˗ˋˏ♡ˎˊ˗",
    Default = false,
    Flag = "NoClipFlag",
    Callback = function(Value)
        NoClipEnabled = Value
        if Value then
            setupNoClip()
        elseif NoClipConnection then
            NoClipConnection:Disconnect()
            NoClipConnection = nil
        end
        if not Value and LocalPlayer.Character then
            for _, part in ipairs(LocalPlayer.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end
})

ExtraGroup:AddToggle({
    Title = "˗ˋˏ♡ˎˊ˗Fullbright˗ˋˏ♡ˎˊ˗",
    Default = false,
    Flag = "FullbrightFlag",
    Callback = function(Value)
        FullbrightEnabled = Value
        setFullbright(Value)
    end
})

LocalPlayer.CharacterAdded:Connect(function()
    if NoClipEnabled then
        task.wait(0.5)
        setupNoClip()
    end
end)

game:GetService("UserInputService").WindowFocused:Connect(function()
    if not NoClipEnabled and not FullbrightEnabled then return end
    if not NoClipEnabled and NoClipConnection then
        NoClipConnection:Disconnect()
        NoClipConnection = nil
    end
    if not FullbrightEnabled and OriginalLighting then
        setFullbright(false)
    end
end)

ExtraGroup:AddImage({
    Image = "rbxassetid://5410949701", 
    Size = UDim2.new(0, 120, 0, 120), 
})

PlayerGroup:AddButton({
    Title = "Полёт (V)",
    Description = "Включение режима полёта по нажатию V ",
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/9bNj1EcR'),true))()
    end
})

PlayerGroup:AddButton({
    Title = "Невидимость (E)",
    Description = "Делает вашего персонажа невидимым",
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/VtWhnEnm'),true))()
    end
})

PlayerGroup:AddButton({
    Title = "ТП к игрокам",
    Description = "Телепортироваться к другим игрокам",
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/z4HARAHs'),true))()
    end
})

PlayerGroup:AddButton({
    Title = "Падение на месте (R)",
    Description = "Персонаж падает на месте без движения",
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/CTUaCKN1'),true))()
    end
})

PlayerGroup:AddButton({
    Title = "Свободная камера (Shift+P)",
    Description = "Отключает привязку камеры к персонажу",
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/ct8Kq5F0'),true))()
    end
})

PlayerGroup:AddButton({
    Title = "Полет на машине (V)",
    Description = "Позволяет транспорту летать",
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/9bNj1EcR'),true))()
    end
})

PlayerGroup:AddButton({
    Title = "Чекпойнты",
    Description = "Создает точки для быстрой телепортации",
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/rz7uUmED'),true))()
    end
})

PlayerGroup:AddButton({
    Title = "Шейдеры",
    Description = "Улучшает визуальные эффекты игры",
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/1XA5qM3D'),true))()
    end
})

ScriptsGroup:AddButton({
    Title = "Infinite Yield",
    Description = "Мощные админ-команды для управления игрой",
    Callback = function()
       loadstring(game:HttpGet(('https://raw.githubusercontent.com/Infinite-Store/Infinite-Store/main/main.lua'),true))()
    end
})

ScriptsGroup:AddButton({
    Title = "f3x",
    Description = "Прикольный кубик",
    Callback = function()
        loadstring(game:HttpGet(('https://raw.githubusercontent.com/infyiff/backup/refs/heads/main/f3x.lua'),true))()
    end
})

ScriptsGroup:AddButton({
    Title = "DEX Explorer",
    Description = "Инструмент для исследования игровых объектов",
    Callback = function()
        loadstring(game:HttpGet(('https://raw.githubusercontent.com/infyiff/backup/main/dex.lua'),true))()
    end
})

ScriptsGroup:AddButton({
    Title = "DEX++",
    Description = "Инструмент для исследования игровых объектов",
    Callback = function()
        loadstring(game:HttpGet(('https://raw.githubusercontent.com/ltseverydayyou/uuuuuuu/refs/heads/main/DexPlusBackup.luau'),true))()
    end
})

ScriptsGroup:AddButton({
    Title = "Играть с писюном",
    Description = "Добавляет анимацию для развлечения",
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/73RsNXY2'),true))()
    end
})

ScriptsGroup:AddButton({
    Title = "Удалить стены",
    Description = "Удаляет препятствия в игре",
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/FBKJTUyw'),true))()
    end
})

ScriptsGroup:AddButton({
    Title = "Добавить всех в друзья",
    Description = "Автоматически отправляет заявки в друзья",
    Callback = function()
        local plrs = game:GetService('Players')
        for i,v in pairs(plrs:GetChildren()) do
            task.wait(1)
            plrs.LocalPlayer:RequestFriendship(v)
        end
    end
})

ScriptsGroup:AddButton({
    Title = "Обход голосового чата",
    Description = "Позволяет обойти ограничения голосового чата",
    Callback = function()
        loadstring(game:HttpGet(('https://raw.githubusercontent.com/CorpseCMD/MyScripts/main/VoicechatBypass.lua'),true))()
    end
})

ScriptsGroup:AddButton({
    Title = "Sigma Spy",
    Description = "Мониторинг игровых событий",
    Callback = function()
        loadstring(game:HttpGet(('https://raw.githubusercontent.com/depthso/Sigma-Spy/main/Main.lua'),true))()
    end
})

ScriptsGroup:AddButton({
    Title = "Админ Команды от 1qlua",
    Description = "Набор административных команд",
    Callback = function()
        loadstring(game:HttpGet(('https://pastebin.com/raw/t3chuwNu'),true))()
    end
})

ScriptsGroup:AddButton({
    Title = "Тест инжектора",
    Description = "Проверить ваш инжектор",
    Callback = function()
        loadstring(game:HttpGet(('https://rawscripts.net/raw/Universal-Script-UNChecker-GUI-Version-27355'),true))()
    end
})

ScriptsGroup:AddButton({
    Title = "Поменять сервер",
    Description = "Быстро поменять сервер",
    Callback = function()
        loadstring(game:HttpGet(('https://raw.githubusercontent.com/Syr0nix/RedFoxServerBowser/main/Mainlua'),true))()
    end
})


TpGrouo:AddButton({
    Title = "☃ Выбрать | игрока ☃",
    Callback = function()
        UpdatePlayerList()
        MainFrame.Visible = true
        task.wait(0.1)
        SearchBox:CaptureFocus()
    end
})

TpGrouo:AddButton({
    Title = "웃 Телепортироваться 웃",
    Callback = function()
        TeleportToPlayer()
    end
})

TpGrouo:AddToggle({
    Title = "『ESP игрока』",
    Default = false,
    Callback = function(Value)
        ToggleESP(Value)
    end
})


CloseButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
end)

SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
    UpdatePlayerList()
end)

Players.PlayerAdded:Connect(function(player)
    task.wait(0.5)
    UpdatePlayerList()
end)

Players.PlayerRemoving:Connect(function(player)
    task.wait(0.5)
    UpdatePlayerList()
    if player == SelectedPlayer then
        SelectedPlayer = nil
        if selectedPlayerLabel then
            selectedPlayerLabel.SetText("Выбранный: Нет")
        end
    end
    if PlayerESP[player] then
        PlayerESP[player]:Destroy()
        PlayerESP[player] = nil
    end
end)

local function CharacterAdded(player, character)
    if PlayerESP[player] and ESPEnabled then
        PlayerESP[player]:Destroy()
        local highlight = Instance.new("Highlight")
        highlight.OutlineTransparency = 0
        highlight.FillTransparency = 0.5
        highlight.FillColor = Color3.fromRGB(255, 0, 0)
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.Parent = character
        PlayerESP[player] = highlight
    end
end

local function CharacterRemoving(player, character)
    if PlayerESP[player] then
        PlayerESP[player]:Destroy()
        PlayerESP[player] = nil
    end
end

for _, player in pairs(Players:GetPlayers()) do
    if player.Character then
        player.CharacterAdded:Connect(function(character)
            CharacterAdded(player, character)
        end)
    end
    player.CharacterAdded:Connect(function(character)
        CharacterAdded(player, character)
    end)
    player.CharacterRemoving:Connect(function(character)
        CharacterRemoving(player, character)
    end)
end

local connection
connection = RunService.RenderStepped:Connect(function()
    if SelectedPlayer then
        if selectedPlayerLabel then
            selectedPlayerLabel.SetText("Выбранный: " .. SelectedPlayer.Name)
        end
    else
        if selectedPlayerLabel then
            selectedPlayerLabel.SetText("Выбранный: Нет")
        end
    end
end)

PlayerSelectionGUI.Destroying:Connect(function()
    if connection then
        connection:Disconnect()
    end
    for _, esp in pairs(PlayerESP) do
        if esp then
            esp:Destroy()
        end
    end
end)

UpdatePlayerList()

FilngGroup:AddToggle({
    Title = "☼walk | Fling☼",
    Default = false,
    Callback = function(Value)
        if Value then
            enableWalkFling()
        else
            disableWalkFling()
        end
    end
})

FilngGroup:AddToggle({
    Title = "✴Anti | Fling✴",
    Default = false,
    Callback = function(Value)
        if Value then
            enableAntiFling()
        else
            disableAntiFling()
        end
    end
})

game.Players.LocalPlayer.CharacterAdded:Connect(function(character)
    character:WaitForChild("Humanoid").Died:Connect(function()
        disableWalkFling()
        disableAntiFling()
    end)
end)

-- ==================== НАСТРОЙКИ ИНТЕРФЕЙСА ====================
local InterfaceGroup = InterfacePage:Groupbox("Настройки интерфейса", "Left")

InterfaceGroup:AddToggle({
    Title = "Показывать водяной знак",
    Default = true,
    Flag = "WatermarkToggle",
    Callback = function(Value)
        Library.WatermarkSettings.Enabled = Value
    end
})

InterfaceGroup:AddTextbox({
    Title = "Текст водяного знака",
    Default = "",
    Placeholder = "Введите свой текст...",
    ClearOnFocus = false,
    Callback = function(Value)
        Library.WatermarkSettings.Text = Value
    end
})

-- ==================== ТЕМА И ЦВЕТА ====================
local ThemeGroup = InterfacePage:Groupbox("Тема и цвета", "Right")

-- Предустановленные темы
local ThemeList = {"По умолчанию", "Темная", "Фиолетовая", "Зеленая", "Синяя", "Красная"}
if Library.ThemePresets then
    for ThemeName, _ in pairs(Library.ThemePresets) do
        table.insert(ThemeList, ThemeName)
    end
    table.sort(ThemeList)
end

ThemeGroup:AddDropdown({
    Title = "Предустановленная тема",
    Values = ThemeList,
    Default = "По умолчанию",
    Multi = false,
    Callback = function(Value)
        if Library.SetTheme then
            Library:SetTheme(Value)
            Library:Notify("Тема", "Применена тема: " .. Value, 2)
        end
    end
})

ThemeGroup:AddSeparator()

-- Кастомизация цветов
ThemeGroup:AddLabel("Пользовательские цвета")

ThemeGroup:AddColorPicker({
    Title = "Акцентный цвет", 
    Default = Library.Theme.Accent or Color3.fromRGB(0, 170, 255), 
    Flag = "ThemeAccent",
    Callback = function(Color, Alpha)
        if Library.UpdateTheme then
            Library:UpdateTheme("Accent", Color)
        end
    end
})

ThemeGroup:AddColorPicker({
    Title = "Фон", 
    Default = Library.Theme.Background or Color3.fromRGB(20, 20, 20), 
    Flag = "ThemeBackground",
    Callback = function(Color, Alpha)
        if Library.UpdateTheme then
            Library:UpdateTheme("Background", Color)
        end
    end
})

ThemeGroup:AddColorPicker({
    Title = "Текст", 
    Default = Library.Theme.Text or Color3.fromRGB(255, 255, 255), 
    Flag = "ThemeText",
    Callback = function(Color, Alpha)
        if Library.UpdateTheme then
            Library:UpdateTheme("Text", Color)
        end
    end
})

ThemeGroup:AddButton({
    Title = "Сбросить цвета",
    Callback = function()
        if Library.SetTheme then
            Library:SetTheme("Default")
            Library:Notify("Тема", "Цвета сброшены", 2)
        end
    end
})

-- ==================== НАСТРОЙКИ ПРОИЗВОДИТЕЛЬНОСТИ ====================
local PerformanceGroup = PerformancePage:Groupbox("Оптимизация", "Left")

PerformanceGroup:AddButton({
    Title = "Оптимизировать игру",
    Description = "Улучшить FPS игры",
    Callback = function()
        local Lighting = game:GetService("Lighting")
        
        -- Базовая оптимизация графики
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 100000
        Lighting.Brightness = 2
        
        -- Оптимизация для различных типов игр
        if game:GetService("Terrain") then
            game:GetService("Terrain").Decoration = false
        end
        
        Library:Notify("Оптимизация", "Настройки графики применены", 3)
    end
})

-- ==================== ГОРЯЧИЕ КЛАВИШИ ====================
local KeybindsGroup = GamePage:Groupbox("Горячие клавиши", "Left")

-- Горячая клавиша для показа/скрытия UI
local uiVisible = true
KeybindsGroup:AddKeybind({
    Title = "Показать/Скрыть UI",
    Default = Enum.KeyCode.RightShift,
    Flag = "ToggleUIKey",
    Callback = function(Key)
        -- Сохраняем клавишу в настройках
        Library.Settings.ToggleUIKey = Key
        Library:Notify("Клавиша", "Клавиша установлена: " .. tostring(Key), 2)
    end
})

-- Обработка горячей клавиши в отдельном потоке
task.spawn(function()
    while true do
        task.wait()
        if Library.Settings and Library.Settings.ToggleUIKey then
            if UserInputService:IsKeyDown(Library.Settings.ToggleUIKey) then
                if Window.Instance then
                    Window.Instance.Enabled = not uiVisible
                    uiVisible = not uiVisible
                    task.wait(0.3) -- Задержка для предотвращения спама
                end
            end
        end
    end
end)

-- Альтернативная клавиша для скрытия
KeybindsGroup:AddKeybind({
    Title = "Экстренное скрытие",
    Default = Enum.KeyCode.End,
    Flag = "HideUIKey",
    Callback = function(Key)
        if Window.Instance then
            Window.Instance.Enabled = false
            uiVisible = false
            Library:Notify("UI", "Интерфейс скрыт", 1)
        end
    end
})

-- ==================== НАСТРОЙКИ ИГРЫ ====================
local GameSettingsGroup = GamePage:Groupbox("Настройки персонажа", "Right")

GameSettingsGroup:AddButton({
    Title = "Телепорт на спавн",
    Callback = function()
        -- Поиск спавн-точки
        local spawnPoints = {
            workspace:FindFirstChild("SpawnLocation"),
            workspace:FindFirstChild("Spawn"),
            workspace:FindFirstChild("SpawnPoint")
        }
        
        for _, spawn in pairs(spawnPoints) do
            if spawn then
                if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = spawn.CFrame
                    Library:Notify("Телепорт", "Перенесен на спавн", 2)
                    return
                end
            end
        end
        Library:Notify("Ошибка", "Спавн не найден", 3)
    end
})

-- ==================== НАСТРОЙКИ БЕЗОПАСНОСТИ ====================
local SecurityGroup = SecurityPage:Groupbox("Защита", "Left")

SecurityGroup:AddToggle({
    Title = "Анти-афк",
    Default = true,
    Description = "Предотвращать кик за бездействие",
    Callback = function(Value)
        if Value then
            -- Стандартная анти-афк система Roblox
            local vu = game:GetService("VirtualUser")
            game:GetService("Players").LocalPlayer.Idled:Connect(function()
                vu:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
                wait(1)
                vu:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
            end)
            Library:Notify("Защита", "Анти-АФК активирован", 2)
        else
            Library:Notify("Защита", "Анти-АФК отключен", 2)
        end
    end
})

SecurityGroup:AddToggle({
    Title = "Скрывать интерфейс",
    Default = false,
    Description = "Автоматически скрывать UI при скриншотах",
    Callback = function(Value)
        Library.Settings.AutoHide = Value
        if Value then
            Library:Notify("Защита", "UI будет скрываться при PrintScreen", 2)
        end
    end
})

SecurityGroup:AddToggle({
    Title = "Защита от вылетов",
    Default = true,
    Description = "Пытаться предотвратить вылеты игры",
    Callback = function(Value)
        Library.Settings.CrashProtection = Value
        if Value then
            -- Базовая защита от распространенных вылетов
            game:GetService("ScriptContext").Error:Connect(function(message, trace)
                if string.find(message:lower(), "crash") or string.find(message:lower(), "kick") then
                    warn("Защита: предотвращен вылет - " .. message)
                end
            end)
        end
    end
})

-- ==================== ИНФОРМАЦИОННАЯ ПАНЕЛЬ ====================
local InfoGroup = PerformancePage:Groupbox("Информация", "Right")

InfoGroup:AddLabelText("Версия скрипта:", "RedOnyx V17")
InfoGroup:AddLabelText("Игра:", game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name)
InfoGroup:AddLabelText("Игрок:", LocalPlayer.Name)
InfoGroup:AddLabelText("Место в игре:", game.PlaceId)

-- Отображение FPS
local fpsLabel = InfoGroup:AddLabel("FPS: 60")

-- Обновление FPS в реальном времени
task.spawn(function()
    local frames = 0
    local lastTime = tick()
    
    while true do
        task.wait(0.1)
        frames = frames + 1
        
        if tick() - lastTime >= 1 then
            local fps = math.floor(frames / (tick() - lastTime))
            fpsLabel.Text = "FPS: " .. fps
            frames = 0
            lastTime = tick()
        end
    end
end)

InfoGroup:AddSeparator()
InfoGroup:AddButton({
    Title = "Скопировать информацию",
    Description = "Скопировать информацию об игре",
    Callback = function()
        local info = string.format([[
Игра: %s
ID игры: %s
Игрок: %s
Сервер: %s
]], 
            game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name,
            game.PlaceId,
            LocalPlayer.Name,
            game.JobId
        )
        setclipboard(info)
        Library:Notify("Инфо", "Информация скопирована!", 2)
    end
})

-- ==================== БЫСТРЫЕ ДЕЙСТВИЯ ====================
local QuickActionsGroup = SecurityPage:Groupbox("Быстрые действия", "Right")

QuickActionsGroup:AddButton({
    Title = "Переподключиться",
    Description = "Вернуться на этот сервер",
    Callback = function()
        game:GetService("TeleportService"):Teleport(game.PlaceId)
    end
})

QuickActionsGroup:AddButton({
    Title = "Сменить сервер",
    Description = "Перейти на другой сервер",
    Callback = function()
        -- Простой поиск другого сервера
        local success, result = pcall(function()
            return game:GetService("HttpService"):JSONDecode(
                game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?limit=10")
            )
        end)
        
        if success and result.data then
            for _, server in pairs(result.data) do
                if server.playing < server.maxPlayers and server.id ~= game.JobId then
                    game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, server.id)
                    return
                end
            end
        end
        Library:Notify("Ошибка", "Не удалось найти сервер", 3)
    end
})

QuickActionsGroup:AddButton({
    Title = "Скопировать ID игры",
    Callback = function()
        setclipboard(tostring(game.PlaceId))
        Library:Notify("Инфо", "ID игры скопирован!", 2)
    end
})

QuickActionsGroup:AddButton({
    Title = "Сбросить персонажа",
    Callback = function()
        if LocalPlayer.Character then
            LocalPlayer.Character:BreakJoints()
            task.wait(0.5)
            if LocalPlayer.Character then
                LocalPlayer.Character:Destroy()
            end
        end
    end
})


-- Тоггл включения/выключения музыки
musicToggle = MusicGroup:AddToggle({
    Title = "Включить музыку",
    Default = false,
    Callback = function(Value)
        if Value then
            playMusic()
        else
            stopMusic()
        end
    end
})

-- Слайдер громкости
MusicGroup:AddSlider({
    Title = "Громкость",
    Min = 0,
    Max = 5,
    Default = currentVolume,
    Rounding = 1,
    Suffix = "",
    Callback = function(Value)
        setVolume(Value)
    end
})

-- Тоггл повтора
MusicGroup:AddToggle({
    Title = "Повторять трек",
    Default = isLooped,
    Callback = function(Value)
        isLooped = Value
        if sound then
            sound.Looped = isLooped
        end
    end
})

-- Кнопка перезапуска
MusicGroup:AddButton({
    Title = "Перезапустить трек",
    Callback = function()
        if sound then
            sound:Stop()
            task.wait(0.1)
            sound:Play()
            if musicToggle then
                musicToggle:Set(true)
            end
        end
    end
})


-- Информация о треке
InfGroup:AddParagraph({
    Title = "The Living Tombstone - \nCats (замедлено + \nреверберация)",
    TextWrapped = true
})

-- Автоматическая загрузка и запуск через 3 секунды
task.spawn(function()
    -- Ждем немного перед загрузкой
    task.wait(1)
    
    -- Загружаем музыку
    local loaded = initializeMusic()
    
    if loaded then
        task.wait(2) -- Ждем еще 2 секунды (всего 3 секунды)
        
        -- Автоматически запускаем музыку
        if settings.AutoPlay then
            if playMusic() then
                -- Включаем тоггл в интерфейсе
                if musicToggle then
                    musicToggle:Set(true)
                end
            end
        end
    end
end)

-- Очистка при выходе из игры
game:GetService("Players").PlayerRemoving:Connect(function(player)
    if player == LocalPlayer and sound then
        sound:Stop()
        sound:Destroy()
    end
end)

local oldWarn = warn
warn = function() end

return "Музыкальный плеер успешно загружен"
