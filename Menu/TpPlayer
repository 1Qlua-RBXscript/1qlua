local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")

-- –°–æ–∑–¥–∞–Ω–∏–µ GUI –≤ CoreGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PlayerTeleporterGUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.DisplayOrder = 9999
ScreenGui.Parent = game:GetService("CoreGui")

-- –û—Å–Ω–æ–≤–Ω–æ–µ –æ–∫–Ω–æ
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 520, 0, 650)
MainFrame.Position = UDim2.new(0.5, -260, 0.5, -325)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

-- –ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

-- –¢–µ–Ω—å
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(70, 70, 90)
UIStroke.Thickness = 2
UIStroke.Parent = MainFrame

-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 45)
TitleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local UICorner2 = Instance.new("UICorner")
UICorner2.CornerRadius = UDim.new(0, 12, 0, 0)
UICorner2.Parent = TitleBar

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(0.7, 0, 1, 0)
TitleLabel.Position = UDim2.new(0, 15, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "üéÆ –¢–ï–õ–ï–ü–û–†–¢–ï–† –ò–ì–†–û–ö–û–í"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 18
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 32, 0, 32)
CloseButton.Position = UDim2.new(1, -42, 0.5, -16)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
CloseButton.Text = "‚úï"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 18
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleBar

local UICorner3 = Instance.new("UICorner")
UICorner3.CornerRadius = UDim.new(0, 6)
UICorner3.Parent = CloseButton

-- –í–∫–ª–∞–¥–∫–∏ (–í—Å–µ –∏–≥—Ä–æ–∫–∏ / –ò–∑–±—Ä–∞–Ω–Ω—ã–µ)
local TabsFrame = Instance.new("Frame")
TabsFrame.Name = "TabsFrame"
TabsFrame.Size = UDim2.new(1, -30, 0, 40)
TabsFrame.Position = UDim2.new(0, 15, 0, 55)
TabsFrame.BackgroundTransparency = 1
TabsFrame.Parent = MainFrame

local AllPlayersTab = Instance.new("TextButton")
AllPlayersTab.Name = "AllPlayersTab"
AllPlayersTab.Size = UDim2.new(0.5, -5, 1, 0)
AllPlayersTab.Position = UDim2.new(0, 0, 0, 0)
AllPlayersTab.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
AllPlayersTab.Text = "üë• –í–°–ï –ò–ì–†–û–ö–ò"
AllPlayersTab.TextColor3 = Color3.fromRGB(255, 255, 255)
AllPlayersTab.TextSize = 14
AllPlayersTab.Font = Enum.Font.GothamBold
AllPlayersTab.Parent = TabsFrame

local UICornerAll = Instance.new("UICorner")
UICornerAll.CornerRadius = UDim.new(0, 6, 0, 0)
UICornerAll.Parent = AllPlayersTab

local FavoritesTab = Instance.new("TextButton")
FavoritesTab.Name = "FavoritesTab"
FavoritesTab.Size = UDim2.new(0.5, -5, 1, 0)
FavoritesTab.Position = UDim2.new(0.5, 5, 0, 0)
FavoritesTab.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
FavoritesTab.Text = "‚≠ê –ò–ó–ë–†–ê–ù–ù–´–ï"
FavoritesTab.TextColor3 = Color3.fromRGB(200, 200, 200)
FavoritesTab.TextSize = 14
FavoritesTab.Font = Enum.Font.GothamBold
FavoritesTab.Parent = TabsFrame

local UICornerFav = Instance.new("UICorner")
UICornerFav.CornerRadius = UDim.new(0, 6, 0, 0)
UICornerFav.Parent = FavoritesTab

-- –û–±–ª–∞—Å—Ç—å –ø–æ–∏—Å–∫–∞
local SearchFrame = Instance.new("Frame")
SearchFrame.Name = "SearchFrame"
SearchFrame.Size = UDim2.new(1, -30, 0, 55)
SearchFrame.Position = UDim2.new(0, 15, 0, 100)
SearchFrame.BackgroundTransparency = 1
SearchFrame.Parent = MainFrame

local SearchBox = Instance.new("TextBox")
SearchBox.Name = "SearchBox"
SearchBox.Size = UDim2.new(1, 0, 0, 45)
SearchBox.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
SearchBox.TextColor3 = Color3.fromRGB(255, 255, 255)
SearchBox.PlaceholderText = "üîç –ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–æ–≤..."
SearchBox.PlaceholderColor3 = Color3.fromRGB(160, 160, 180)
SearchBox.Text = ""
SearchBox.TextSize = 14
SearchBox.Font = Enum.Font.Gotham
SearchBox.ClearTextOnFocus = false
SearchBox.Parent = SearchFrame

local UICorner4 = Instance.new("UICorner")
UICorner4.CornerRadius = UDim.new(0, 10)
UICorner4.Parent = SearchBox

local UIPadding = Instance.new("UIPadding")
UIPadding.PaddingLeft = UDim.new(0, 15)
UIPadding.PaddingRight = UDim.new(0, 15)
UIPadding.Parent = SearchBox

-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
local PlayersScrollFrame = Instance.new("ScrollingFrame")
PlayersScrollFrame.Name = "PlayersScrollFrame"
PlayersScrollFrame.Size = UDim2.new(1, -30, 1, -160)
PlayersScrollFrame.Position = UDim2.new(0, 15, 0, 165)
PlayersScrollFrame.BackgroundTransparency = 1
PlayersScrollFrame.ScrollBarThickness = 8
PlayersScrollFrame.ScrollBarImageColor3 = Color3.fromRGB(90, 90, 110)
PlayersScrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
PlayersScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
PlayersScrollFrame.Parent = MainFrame

local PlayersListLayout = Instance.new("UIListLayout")
PlayersListLayout.Name = "PlayersListLayout"
PlayersListLayout.Padding = UDim.new(0, 8)
PlayersListLayout.Parent = PlayersScrollFrame

-- –ö–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏
local ButtonsFrame = Instance.new("Frame")
ButtonsFrame.Name = "ButtonsFrame"
ButtonsFrame.Size = UDim2.new(1, -30, 0, 45)
ButtonsFrame.Position = UDim2.new(0, 15, 1, -55)
ButtonsFrame.BackgroundTransparency = 1
ButtonsFrame.Parent = MainFrame

local SaveButton = Instance.new("TextButton")
SaveButton.Name = "SaveButton"
SaveButton.Size = UDim2.new(0.48, 0, 1, 0)
SaveButton.Position = UDim2.new(0, 0, 0, 0)
SaveButton.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
SaveButton.Text = "üíæ –°–û–•–†–ê–ù–ò–¢–¨"
SaveButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SaveButton.TextSize = 14
SaveButton.Font = Enum.Font.GothamBold
SaveButton.Parent = ButtonsFrame

local UICorner5 = Instance.new("UICorner")
UICorner5.CornerRadius = UDim.new(0, 8)
UICorner5.Parent = SaveButton

local LoadButton = Instance.new("TextButton")
LoadButton.Name = "LoadButton"
LoadButton.Size = UDim2.new(0.48, 0, 1, 0)
LoadButton.Position = UDim2.new(0.52, 0, 0, 0)
LoadButton.BackgroundColor3 = Color3.fromRGB(80, 220, 140)
LoadButton.Text = "üìÇ –ó–ê–ì–†–£–ó–ò–¢–¨"
LoadButton.TextColor3 = Color3.fromRGB(255, 255, 255)
LoadButton.TextSize = 14
LoadButton.Font = Enum.Font.GothamBold
LoadButton.Parent = ButtonsFrame

local UICorner6 = Instance.new("UICorner")
UICorner6.CornerRadius = UDim.new(0, 8)
UICorner6.Parent = LoadButton

-- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
local dragging = false
local dragInput, dragStart, startPos
local localPlayer = Players.LocalPlayer
local character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- –°–æ—Å—Ç–æ—è–Ω–∏—è
local favorites = {}
local currentTab = "all" -- "all" –∏–ª–∏ "favorites"
local playerEntries = {}

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
local function setupButtonHover(button, hoverColor, normalColor)
    local hoverColor = hoverColor or button.BackgroundColor3
    local normalColor = normalColor or button.BackgroundColor3
    
    button.MouseEnter:Connect(function()
        game:GetService("TweenService"):Create(button, TweenInfo.new(0.2), {BackgroundColor3 = hoverColor}):Play()
    end)
    
    button.MouseLeave:Connect(function()
        game:GetService("TweenService"):Create(button, TweenInfo.new(0.2), {BackgroundColor3 = normalColor}):Play()
    end)
end

-- –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –∫ –∫–Ω–æ–ø–∫–∞–º
setupButtonHover(CloseButton, Color3.fromRGB(220, 80, 80), Color3.fromRGB(200, 60, 60))
setupButtonHover(AllPlayersTab, Color3.fromRGB(90, 160, 240), Color3.fromRGB(80, 140, 220))
setupButtonHover(FavoritesTab, Color3.fromRGB(80, 80, 100), Color3.fromRGB(60, 60, 80))
setupButtonHover(SaveButton, Color3.fromRGB(90, 160, 240), Color3.fromRGB(80, 140, 220))
setupButtonHover(LoadButton, Color3.fromRGB(90, 240, 160), Color3.fromRGB(80, 220, 140))

-- –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –ø–æ–ª—è –ø–æ–∏—Å–∫–∞
SearchBox.Focused:Connect(function()
    game:GetService("TweenService"):Create(SearchBox, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 70)}):Play()
end)

SearchBox.FocusLost:Connect(function()
    game:GetService("TweenService"):Create(SearchBox, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 40, 55)}):Play()
end)

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ 1qluaseting
local function ensureSettingsFolder()
    local success, result = pcall(function()
        if not isfolder then
            return false
        end
        
        if not isfolder("1qluaseting") then
            makefolder("1qluaseting")
        end
        return true
    end)
    
    return success and result
end

-- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
local function saveSettings()
    if not ensureSettingsFolder() then
        warn("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫")
        return false
    end
    
    local settingsData = {
        favorites = favorites,
        windowPosition = {
            X = MainFrame.Position.X.Scale,
            Y = MainFrame.Position.Y.Scale,
            OffsetX = MainFrame.Position.X.Offset,
            OffsetY = MainFrame.Position.Y.Offset
        },
        windowSize = {
            Width = MainFrame.Size.X.Offset,
            Height = MainFrame.Size.Y.Offset
        }
    }
    
    local json = HttpService:JSONEncode(settingsData)
    
    local success, errorMsg = pcall(function()
        writefile("1qluaseting/TPFAVORIT.json", json)
    end)
    
    if success then
        print("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã")
        return true
    else
        warn("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: " .. tostring(errorMsg))
        return false
    end
end

-- –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
local function loadSettings()
    if not ensureSettingsFolder() then
        return false
    end
    
    if not isfile then
        return false
    end
    
    if not isfile("1qluaseting/TPFAVORIT.json") then
        return false
    end
    
    local success, result = pcall(function()
        local json = readfile("1qluaseting/TPFAVORIT.json")
        return HttpService:JSONDecode(json)
    end)
    
    if success and result then
        favorites = result.favorites or {}
        
        if result.windowPosition then
            MainFrame.Position = UDim2.new(
                result.windowPosition.X,
                result.windowPosition.OffsetX,
                result.windowPosition.Y,
                result.windowPosition.OffsetY
            )
        end
        
        if result.windowSize then
            MainFrame.Size = UDim2.new(
                0,
                result.windowSize.Width,
                0,
                result.windowSize.Height
            )
        end
        
        print("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
        return true
    else
        warn("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫")
        return false
    end
end

-- –§—É–Ω–∫—Ü–∏—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
local function teleportToPlayer(player)
    local targetCharacter = player.Character
    if not targetCharacter then
        warn("–£ –∏–≥—Ä–æ–∫–∞ –Ω–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!")
        return
    end
    
    local targetRoot = targetCharacter:FindFirstChild("HumanoidRootPart")
    if not targetRoot then
        warn("–£ –∏–≥—Ä–æ–∫–∞ –Ω–µ—Ç HumanoidRootPart!")
        return
    end
    
    -- –¢–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ–º—Å—è
    character:SetPrimaryPartCFrame(targetRoot.CFrame + Vector3.new(0, 3, 0))
    
    -- –ù–µ–±–æ–ª—å—à–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
    local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(humanoidRootPart, tweenInfo, {CFrame = targetRoot.CFrame + Vector3.new(0, 3, 0)})
    tween:Play()
    
    print("–¢–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –∫ –∏–≥—Ä–æ–∫—É: " .. player.Name)
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–≥—Ä–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã–º
local function isPlayerFavorite(player)
    for _, userId in ipairs(favorites) do
        if userId == player.UserId then
            return true
        end
    end
    return false
end

-- –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–≥—Ä–æ–∫–∞
local function createPlayerEntry(player, showFavoriteButton)
    local isFavorite = isPlayerFavorite(player)
    
    local entryFrame = Instance.new("Frame")
    entryFrame.Name = "PlayerEntry_" .. player.UserId
    entryFrame.Size = UDim2.new(1, 0, 0, 85)
    entryFrame.BackgroundColor3 = isFavorite and Color3.fromRGB(55, 65, 85) or Color3.fromRGB(45, 45, 60)
    entryFrame.Parent = PlayersScrollFrame
    
    local UICornerEntry = Instance.new("UICorner")
    UICornerEntry.CornerRadius = UDim.new(0, 10)
    UICornerEntry.Parent = entryFrame
    
    -- –ê–≤–∞—Ç–∞—Ä–∫–∞
    local AvatarFrame = Instance.new("Frame")
    AvatarFrame.Size = UDim2.new(0, 55, 0, 55)
    AvatarFrame.Position = UDim2.new(0, 10, 0.5, -27.5)
    AvatarFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    AvatarFrame.Parent = entryFrame
    
    local UICornerAvatar = Instance.new("UICorner")
    UICornerAvatar.CornerRadius = UDim.new(0, 28)
    UICornerAvatar.Parent = AvatarFrame
    
    local AvatarImage = Instance.new("ImageLabel")
    AvatarImage.Size = UDim2.new(1, -4, 1, -4)
    AvatarImage.Position = UDim2.new(0, 2, 0, 2)
    AvatarImage.BackgroundTransparency = 1
    AvatarImage.Image = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. player.UserId .. "&width=150&height=150&format=png"
    AvatarImage.Parent = AvatarFrame
    
    -- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–æ–∫–µ
    local InfoFrame = Instance.new("Frame")
    InfoFrame.Size = UDim2.new(0, 220, 1, 0)
    InfoFrame.Position = UDim2.new(0, 75, 0, 0)
    InfoFrame.BackgroundTransparency = 1
    InfoFrame.Parent = entryFrame
    
    local DisplayNameLabel = Instance.new("TextLabel")
    DisplayNameLabel.Size = UDim2.new(1, 0, 0, 35)
    DisplayNameLabel.Position = UDim2.new(0, 0, 0, 10)
    DisplayNameLabel.BackgroundTransparency = 1
    DisplayNameLabel.Text = player.DisplayName
    DisplayNameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    DisplayNameLabel.TextSize = 16
    DisplayNameLabel.Font = Enum.Font.GothamBold
    DisplayNameLabel.TextXAlignment = Enum.TextXAlignment.Left
    DisplayNameLabel.Parent = InfoFrame
    
    local UserNameLabel = Instance.new("TextLabel")
    UserNameLabel.Size = UDim2.new(1, 0, 0, 25)
    UserNameLabel.Position = UDim2.new(0, 0, 0, 45)
    UserNameLabel.BackgroundTransparency = 1
    UserNameLabel.Text = "@" .. player.Name
    UserNameLabel.TextColor3 = Color3.fromRGB(180, 180, 200)
    UserNameLabel.TextSize = 14
    UserNameLabel.Font = Enum.Font.Gotham
    UserNameLabel.TextXAlignment = Enum.TextXAlignment.Left
    UserNameLabel.Parent = InfoFrame
    
    -- –§—Ä–µ–π–º –¥–ª—è –∫–Ω–æ–ø–æ–∫
    local ButtonsContainer = Instance.new("Frame")
    ButtonsContainer.Size = UDim2.new(0, 170, 1, 0)
    ButtonsContainer.Position = UDim2.new(1, -180, 0, 0)
    ButtonsContainer.BackgroundTransparency = 1
    ButtonsContainer.Parent = entryFrame
    
    -- –ö–Ω–æ–ø–∫–∞ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
    local TeleportButton = Instance.new("TextButton")
    TeleportButton.Name = "TeleportButton"
    TeleportButton.Size = UDim2.new(0, 110, 0, 35)
    TeleportButton.Position = showFavoriteButton and UDim2.new(0, 0, 0.5, -17.5) or UDim2.new(0, 30, 0.5, -17.5)
    TeleportButton.BackgroundColor3 = Color3.fromRGB(80, 160, 220)
    TeleportButton.Text = "üöÄ –¢–ï–õ–ï–ü–û–†–¢"
    TeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    TeleportButton.TextSize = 14
    TeleportButton.Font = Enum.Font.GothamBold
    TeleportButton.Parent = ButtonsContainer
    
    local UICornerTeleport = Instance.new("UICorner")
    UICornerTeleport.CornerRadius = UDim.new(0, 8)
    UICornerTeleport.Parent = TeleportButton
    
    -- –ö–Ω–æ–ø–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º)
    local FavoriteButton
    if showFavoriteButton then
        FavoriteButton = Instance.new("TextButton")
        FavoriteButton.Name = "FavoriteButton"
        FavoriteButton.Size = UDim2.new(0, 45, 0, 35)
        FavoriteButton.Position = UDim2.new(1, -50, 0.5, -17.5)
        FavoriteButton.BackgroundColor3 = isFavorite and Color3.fromRGB(255, 200, 50) or Color3.fromRGB(100, 100, 120)
        FavoriteButton.Text = isFavorite and "‚≠ê" or "‚òÜ"
        FavoriteButton.TextColor3 = isFavorite and Color3.fromRGB(255, 255, 0) or Color3.fromRGB(200, 200, 200)
        FavoriteButton.TextSize = 20
        FavoriteButton.Font = Enum.Font.GothamBold
        FavoriteButton.Parent = ButtonsContainer
        
        local UICornerFavorite = Instance.new("UICorner")
        UICornerFavorite.CornerRadius = UDim.new(0, 8)
        UICornerFavorite.Parent = FavoriteButton
        
        setupButtonHover(FavoriteButton, 
            isFavorite and Color3.fromRGB(255, 220, 70) or Color3.fromRGB(120, 120, 140),
            isFavorite and Color3.fromRGB(255, 200, 50) or Color3.fromRGB(100, 100, 120))
    end
    
    setupButtonHover(TeleportButton, Color3.fromRGB(90, 180, 240), Color3.fromRGB(80, 160, 220))
    
    -- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    TeleportButton.MouseButton1Click:Connect(function()
        teleportToPlayer(player)
    end)
    
    if FavoriteButton then
        FavoriteButton.MouseButton1Click:Connect(function()
            local wasFavorite = isPlayerFavorite(player)
            
            if wasFavorite then
                -- –£–¥–∞–ª—è–µ–º –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                for i, userId in ipairs(favorites) do
                    if userId == player.UserId then
                        table.remove(favorites, i)
                        break
                    end
                end
                print("–£–¥–∞–ª–µ–Ω –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ: " .. player.Name)
                
                -- –û–±–Ω–æ–≤–ª—è–µ–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∫–Ω–æ–ø–∫–∏
                FavoriteButton.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
                FavoriteButton.Text = "‚òÜ"
                FavoriteButton.TextColor3 = Color3.fromRGB(200, 200, 200)
                
                setupButtonHover(FavoriteButton, Color3.fromRGB(120, 120, 140), Color3.fromRGB(100, 100, 120))
                
                -- –ï—Å–ª–∏ –º—ã –≤ —Ä–µ–∂–∏–º–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                if currentTab == "favorites" then
                    updatePlayersList()
                end
            else
                -- –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                table.insert(favorites, player.UserId)
                print("–î–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ: " .. player.Name)
                
                -- –û–±–Ω–æ–≤–ª—è–µ–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∫–Ω–æ–ø–∫–∏
                FavoriteButton.BackgroundColor3 = Color3.fromRGB(255, 200, 50)
                FavoriteButton.Text = "‚≠ê"
                FavoriteButton.TextColor3 = Color3.fromRGB(255, 255, 0)
                
                setupButtonHover(FavoriteButton, Color3.fromRGB(255, 220, 70), Color3.fromRGB(255, 200, 50))
            end
            
            -- –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –∑–∞–ø–∏—Å–∏
            entryFrame.BackgroundColor3 = isPlayerFavorite(player) and Color3.fromRGB(55, 65, 85) or Color3.fromRGB(45, 45, 60)
        end)
    end
    
    playerEntries[player.UserId] = entryFrame
    return entryFrame
end

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
local function updatePlayersList()
    local searchText = SearchBox.Text and string.lower(SearchBox.Text) or ""
    
    -- –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∑–∞–ø–∏—Å–∏
    for _, entry in pairs(playerEntries) do
        if entry and entry.Parent then
            entry:Destroy()
        end
    end
    playerEntries = {}
    
    -- –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
    local allPlayers = Players:GetPlayers()
    local filteredPlayers = {}
    
    -- –§–∏–ª—å—Ç—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∫–ª–∞–¥–∫–∏
    for _, player in ipairs(allPlayers) do
        if player ~= localPlayer then
            local displayName = player.DisplayName or player.Name
            local userName = player.Name
            
            -- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–∏—Å–∫—É
            local matchesSearch = searchText == "" or 
               string.find(string.lower(displayName), searchText) or
               string.find(string.lower(userName), searchText)
            
            if matchesSearch then
                if currentTab == "favorites" then
                    -- –¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∏
                    if isPlayerFavorite(player) then
                        table.insert(filteredPlayers, player)
                    end
                else
                    -- –í—Å–µ –∏–≥—Ä–æ–∫–∏
                    table.insert(filteredPlayers, player)
                end
            end
        end
    end
    
    -- –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ "–≤—Å–µ –∏–≥—Ä–æ–∫–∏")
    if currentTab == "all" then
        table.sort(filteredPlayers, function(a, b)
            local aFavorite = isPlayerFavorite(a)
            local bFavorite = isPlayerFavorite(b)
            
            if aFavorite and not bFavorite then
                return true
            elseif not aFavorite and bFavorite then
                return false
            else
                return (a.DisplayName or a.Name) < (b.DisplayName or b.Name)
            end
        end)
    else
        -- –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ –∏–º–µ–Ω–∏
        table.sort(filteredPlayers, function(a, b)
            return (a.DisplayName or a.Name) < (b.DisplayName or b.Name)
        end)
    end
    
    -- –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å–∏ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
    for _, player in ipairs(filteredPlayers) do
        -- –ù–∞ –≤–∫–ª–∞–¥–∫–µ "–∏–∑–±—Ä–∞–Ω–Ω—ã–µ" –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
        local showFavoriteButton = currentTab == "all"
        createPlayerEntry(player, showFavoriteButton)
    end
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    local totalPlayers = #filteredPlayers
    PlayersScrollFrame.CanvasSize = UDim2.new(0, 0, 0, totalPlayers * 93)
    
    print("–°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω. –ò–≥—Ä–æ–∫–æ–≤: " .. totalPlayers .. " (–≤–∫–ª–∞–¥–∫–∞: " .. currentTab .. ")")
end

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è GUI
TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TitleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input == dragInput then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–∞
SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
    updatePlayersList()
end)

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∫–ª–∞–¥–æ–∫
AllPlayersTab.MouseButton1Click:Connect(function()
    if currentTab ~= "all" then
        currentTab = "all"
        AllPlayersTab.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
        AllPlayersTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        FavoritesTab.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
        FavoritesTab.TextColor3 = Color3.fromRGB(200, 200, 200)
        
        setupButtonHover(AllPlayersTab, Color3.fromRGB(90, 160, 240), Color3.fromRGB(80, 140, 220))
        setupButtonHover(FavoritesTab, Color3.fromRGB(80, 80, 100), Color3.fromRGB(60, 60, 80))
        
        updatePlayersList()
    end
end)

FavoritesTab.MouseButton1Click:Connect(function()
    if currentTab ~= "favorites" then
        currentTab = "favorites"
        FavoritesTab.BackgroundColor3 = Color3.fromRGB(255, 200, 50)
        FavoritesTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        AllPlayersTab.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
        AllPlayersTab.TextColor3 = Color3.fromRGB(200, 200, 200)
        
        setupButtonHover(FavoritesTab, Color3.fromRGB(255, 220, 70), Color3.fromRGB(255, 200, 50))
        setupButtonHover(AllPlayersTab, Color3.fromRGB(80, 80, 100), Color3.fromRGB(60, 60, 80))
        
        updatePlayersList()
    end
end)

-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
    script:Destroy()
    print("–°–∫—Ä–∏–ø—Ç –æ—Ç–∫–ª—é—á–µ–Ω")
end)

-- –ö–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏
SaveButton.MouseButton1Click:Connect(function()
    if saveSettings() then
        -- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        SaveButton.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
        SaveButton.Text = "‚úÖ –°–û–•–†–ê–ù–ï–ù–û!"
        
        task.wait(1)
        
        SaveButton.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
        SaveButton.Text = "üíæ –°–û–•–†–ê–ù–ò–¢–¨"
        
        setupButtonHover(SaveButton, Color3.fromRGB(90, 160, 240), Color3.fromRGB(80, 140, 220))
    end
end)

LoadButton.MouseButton1Click:Connect(function()
    if loadSettings() then
        updatePlayersList()
        
        -- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        LoadButton.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
        LoadButton.Text = "‚úÖ –ó–ê–ì–†–£–ñ–ï–ù–û!"
        
        task.wait(1)
        
        LoadButton.BackgroundColor3 = Color3.fromRGB(80, 220, 140)
        LoadButton.Text = "üìÇ –ó–ê–ì–†–£–ó–ò–¢–¨"
        
        setupButtonHover(LoadButton, Color3.fromRGB(90, 240, 160), Color3.fromRGB(80, 220, 140))
    else
        -- –ê–Ω–∏–º–∞—Ü–∏—è –æ—à–∏–±–∫–∏
        LoadButton.BackgroundColor3 = Color3.fromRGB(220, 100, 100)
        LoadButton.Text = "‚ùå –û–®–ò–ë–ö–ê!"
        
        task.wait(1)
        
        LoadButton.BackgroundColor3 = Color3.fromRGB(80, 220, 140)
        LoadButton.Text = "üìÇ –ó–ê–ì–†–£–ó–ò–¢–¨"
        
        setupButtonHover(LoadButton, Color3.fromRGB(90, 240, 160), Color3.fromRGB(80, 220, 140))
    end
end)

-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
print("–ó–∞–ø—É—Å–∫ GUI —Ç–µ–ª–µ–ø–æ—Ä—Ç–µ—Ä–∞...")

-- –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
local success = pcall(function()
    loadSettings()
end)

if not success then
    print("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é")
end

-- –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
updatePlayersList()

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤
Players.PlayerAdded:Connect(function(player)
    task.wait(1) -- –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞
    updatePlayersList()
end)

Players.PlayerRemoving:Connect(function(player)
    task.wait(0.5)
    updatePlayersList()
end)

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
localPlayer.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
    print("–ü–µ—Ä—Å–æ–Ω–∞–∂ –æ–±–Ω–æ–≤–ª–µ–Ω")
end)

print("‚úÖ GUI —Ç–µ–ª–µ–ø–æ—Ä—Ç–µ—Ä–∞ –∏–≥—Ä–æ–∫–æ–≤ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!")
print("üìä –ò–∑–±—Ä–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤: " .. #favorites)
