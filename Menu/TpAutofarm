
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- Переменные для телепортации
local teleportEnabled = false
local teleportLoop = nil
local currentTarget = nil
local isTeleporting = false
local teleportMode = "Teleport"
local teleportDelay = 1
local flySpeed = 50
local offset = Vector3.new(0, 0, 0)
local playerList = {}
local teleportKeybind = Enum.KeyCode.KeypadZero
local faceTarget = false

-- Создаем основной GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TeleportGUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.DisplayOrder = 999999 -- Максимальный приоритет
ScreenGui.Parent = game:GetService("CoreGui")

-- Основной фрейм
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 450, 0, 550)
MainFrame.Position = UDim2.new(0.5, -225, 0.5, -275)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

-- Скругление углов
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

-- Тень
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(60, 60, 80)
UIStroke.Thickness = 2
UIStroke.Parent = MainFrame

-- Заголовок (для перемещения)
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = TitleBar

local TitleText = Instance.new("TextLabel")
TitleText.Name = "TitleText"
TitleText.Size = UDim2.new(1, -80, 1, 0)
TitleText.Position = UDim2.new(0, 15, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "Teleport GUI"
TitleText.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleText.Font = Enum.Font.GothamBold
TitleText.TextSize = 18
TitleText.TextXAlignment = Enum.TextXAlignment.Left
TitleText.Parent = TitleBar

-- Кнопка закрытия
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -40, 0.5, -15)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 14
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- Кнопка сворачивания
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -80, 0.5, -15)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Text = "_"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.TextSize = 16
MinimizeButton.Parent = TitleBar

local MinimizeCorner = Instance.new("UICorner")
MinimizeCorner.CornerRadius = UDim.new(0, 6)
MinimizeCorner.Parent = MinimizeButton

-- Область контента
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, 0, 1, -40)
ContentFrame.Position = UDim2.new(0, 0, 0, 40)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- ScrollingFrame для контента
local ScrollingFrame = Instance.new("ScrollingFrame")
ScrollingFrame.Name = "ScrollingFrame"
ScrollingFrame.Size = UDim2.new(1, 0, 1, 0)
ScrollingFrame.BackgroundTransparency = 1
ScrollingFrame.BorderSizePixel = 0
ScrollingFrame.ScrollBarThickness = 5
ScrollingFrame.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 100)
ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 800) -- Будет обновляться
ScrollingFrame.Parent = ContentFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 15)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = ScrollingFrame

-- Функция для создания Groupbox
local function createGroupbox(title, position, size)
    local Groupbox = Instance.new("Frame")
    Groupbox.Name = "Groupbox_" .. title
    Groupbox.Size = size or UDim2.new(0.95, 0, 0, 0) -- Высота будет автоматическая
    Groupbox.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    Groupbox.BorderSizePixel = 0
    Groupbox.LayoutOrder = position == "Left" and 1 or 2
    
    local GroupboxCorner = Instance.new("UICorner")
    GroupboxCorner.CornerRadius = UDim.new(0, 6)
    GroupboxCorner.Parent = Groupbox
    
    local GroupboxStroke = Instance.new("UIStroke")
    GroupboxStroke.Color = Color3.fromRGB(60, 60, 80)
    GroupboxStroke.Thickness = 1
    GroupboxStroke.Parent = Groupbox
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "TitleLabel"
    TitleLabel.Size = UDim2.new(1, -20, 0, 30)
    TitleLabel.Position = UDim2.new(0, 10, 0, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = title
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.Font = Enum.Font.GothamSemibold
    TitleLabel.TextSize = 16
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = Groupbox
    
    local ContentContainer = Instance.new("Frame")
    ContentContainer.Name = "ContentContainer"
    ContentContainer.Size = UDim2.new(1, -20, 1, -40)
    ContentContainer.Position = UDim2.new(0, 10, 0, 35)
    ContentContainer.BackgroundTransparency = 1
    ContentContainer.Parent = Groupbox
    
    local ContainerListLayout = Instance.new("UIListLayout")
    ContainerListLayout.Padding = UDim.new(0, 10)
    ContainerListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ContainerListLayout.Parent = ContentContainer
    
    Groupbox:GetPropertyChangedSignal("AbsoluteSize"):Connect(function()
        Groupbox.Size = UDim2.new(Groupbox.Size.X.Scale, Groupbox.Size.X.Offset, 0, ContentContainer.AbsoluteSize.Y + 50)
    end)
    
    ContainerListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        ContentContainer.Size = UDim2.new(1, -20, 0, ContainerListLayout.AbsoluteContentSize.Y)
    end)
    
    return Groupbox, ContentContainer
end

-- Функция для создания Toggle
local function createToggle(parent, title, defaultValue, callback)
    local ToggleContainer = Instance.new("Frame")
    ToggleContainer.Name = "ToggleContainer_" .. title
    ToggleContainer.Size = UDim2.new(1, 0, 0, 30)
    ToggleContainer.BackgroundTransparency = 1
    ToggleContainer.LayoutOrder = #parent:GetChildren()
    
    local ToggleLabel = Instance.new("TextLabel")
    ToggleLabel.Name = "ToggleLabel"
    ToggleLabel.Size = UDim2.new(0.7, 0, 1, 0)
    ToggleLabel.BackgroundTransparency = 1
    ToggleLabel.Text = title
    ToggleLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    ToggleLabel.Font = Enum.Font.Gotham
    ToggleLabel.TextSize = 14
    ToggleLabel.TextXAlignment = Enum.TextXAlignment.Left
    ToggleLabel.Parent = ToggleContainer
    
    local ToggleButton = Instance.new("TextButton")
    ToggleButton.Name = "ToggleButton"
    ToggleButton.Size = UDim2.new(0, 50, 0, 25)
    ToggleButton.Position = UDim2.new(1, -50, 0.5, -12.5)
    ToggleButton.BackgroundColor3 = defaultValue and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(60, 60, 80)
    ToggleButton.BorderSizePixel = 0
    ToggleButton.Text = ""
    ToggleButton.Parent = ToggleContainer
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 12)
    ToggleCorner.Parent = ToggleButton
    
    local ToggleIndicator = Instance.new("Frame")
    ToggleIndicator.Name = "ToggleIndicator"
    ToggleIndicator.Size = UDim2.new(0, 21, 0, 21)
    ToggleIndicator.Position = defaultValue and UDim2.new(1, -23, 0.5, -10.5) or UDim2.new(0, 2, 0.5, -10.5)
    ToggleIndicator.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ToggleIndicator.BorderSizePixel = 0
    ToggleIndicator.Parent = ToggleButton
    
    local IndicatorCorner = Instance.new("UICorner")
    IndicatorCorner.CornerRadius = UDim.new(1, 0)
    IndicatorCorner.Parent = ToggleIndicator
    
    local toggleState = defaultValue
    
    ToggleButton.MouseButton1Click:Connect(function()
        toggleState = not toggleState
        
        local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        
        if toggleState then
            local tween1 = TweenService:Create(ToggleButton, tweenInfo, {BackgroundColor3 = Color3.fromRGB(0, 170, 255)})
            local tween2 = TweenService:Create(ToggleIndicator, tweenInfo, {Position = UDim2.new(1, -23, 0.5, -10.5)})
            tween1:Play()
            tween2:Play()
        else
            local tween1 = TweenService:Create(ToggleButton, tweenInfo, {BackgroundColor3 = Color3.fromRGB(60, 60, 80)})
            local tween2 = TweenService:Create(ToggleIndicator, tweenInfo, {Position = UDim2.new(0, 2, 0.5, -10.5)})
            tween1:Play()
            tween2:Play()
        end
        
        if callback then
            callback(toggleState)
        end
    end)
    
    ToggleContainer.Parent = parent
    
    return {
        Set = function(value)
            toggleState = value
            if value then
                ToggleButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
                ToggleIndicator.Position = UDim2.new(1, -23, 0.5, -10.5)
            else
                ToggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
                ToggleIndicator.Position = UDim2.new(0, 2, 0.5, -10.5)
            end
        end,
        Get = function()
            return toggleState
        end
    }
end

-- Функция для создания Slider
local function createSlider(parent, title, min, max, defaultValue, suffix, callback)
    local SliderContainer = Instance.new("Frame")
    SliderContainer.Name = "SliderContainer_" .. title
    SliderContainer.Size = UDim2.new(1, 0, 0, 60)
    SliderContainer.BackgroundTransparency = 1
    SliderContainer.LayoutOrder = #parent:GetChildren()
    
    local SliderLabel = Instance.new("TextLabel")
    SliderLabel.Name = "SliderLabel"
    SliderLabel.Size = UDim2.new(1, 0, 0, 20)
    SliderLabel.BackgroundTransparency = 1
    SliderLabel.Text = title
    SliderLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    SliderLabel.Font = Enum.Font.Gotham
    SliderLabel.TextSize = 14
    SliderLabel.TextXAlignment = Enum.TextXAlignment.Left
    SliderLabel.Parent = SliderContainer
    
    local ValueLabel = Instance.new("TextLabel")
    ValueLabel.Name = "ValueLabel"
    ValueLabel.Size = UDim2.new(0, 60, 0, 20)
    ValueLabel.Position = UDim2.new(1, -60, 0, 0)
    ValueLabel.BackgroundTransparency = 1
    ValueLabel.Text = tostring(defaultValue) .. (suffix or "")
    ValueLabel.TextColor3 = Color3.fromRGB(0, 170, 255)
    ValueLabel.Font = Enum.Font.GothamSemibold
    ValueLabel.TextSize = 14
    ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
    ValueLabel.Parent = SliderContainer
    
    local SliderTrack = Instance.new("Frame")
    SliderTrack.Name = "SliderTrack"
    SliderTrack.Size = UDim2.new(1, 0, 0, 5)
    SliderTrack.Position = UDim2.new(0, 0, 0, 30)
    SliderTrack.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
    SliderTrack.BorderSizePixel = 0
    SliderTrack.Parent = SliderContainer
    
    local TrackCorner = Instance.new("UICorner")
    TrackCorner.CornerRadius = UDim.new(1, 0)
    TrackCorner.Parent = SliderTrack
    
    local SliderFill = Instance.new("Frame")
    SliderFill.Name = "SliderFill"
    SliderFill.Size = UDim2.new((defaultValue - min) / (max - min), 0, 1, 0)
    SliderFill.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    SliderFill.BorderSizePixel = 0
    SliderFill.Parent = SliderTrack
    
    local FillCorner = Instance.new("UICorner")
    FillCorner.CornerRadius = UDim.new(1, 0)
    FillCorner.Parent = SliderFill
    
    local SliderButton = Instance.new("TextButton")
    SliderButton.Name = "SliderButton"
    SliderButton.Size = UDim2.new(0, 20, 0, 20)
    SliderButton.Position = UDim2.new((defaultValue - min) / (max - min), -10, 0.5, -10)
    SliderButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    SliderButton.BorderSizePixel = 0
    SliderButton.Text = ""
    SliderButton.ZIndex = 2
    SliderButton.Parent = SliderTrack
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(1, 0)
    ButtonCorner.Parent = SliderButton
    
    local dragging = false
    local currentValue = defaultValue
    
    local function updateValue(value)
        local clampedValue = math.clamp(value, min, max)
        currentValue = clampedValue
        
        local tweenInfo = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween1 = TweenService:Create(SliderFill, tweenInfo, {Size = UDim2.new((clampedValue - min) / (max - min), 0, 1, 0)})
        local tween2 = TweenService:Create(SliderButton, tweenInfo, {Position = UDim2.new((clampedValue - min) / (max - min), -10, 0.5, -10)})
        tween1:Play()
        tween2:Play()
        
        ValueLabel.Text = tostring(math.floor(clampedValue * 10) / 10) .. (suffix or "")
        
        if callback then
            callback(clampedValue)
        end
    end
    
    SliderButton.MouseButton1Down:Connect(function()
        dragging = true
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    SliderTrack.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            local relativeX = (input.Position.X - SliderTrack.AbsolutePosition.X) / SliderTrack.AbsoluteSize.X
            local value = min + (max - min) * relativeX
            updateValue(value)
        end
    end)
    
    game:GetService("RunService").RenderStepped:Connect(function()
        if dragging then
            local mouse = UserInputService:GetMouseLocation()
            local relativeX = (mouse.X - SliderTrack.AbsolutePosition.X) / SliderTrack.AbsoluteSize.X
            local value = min + (max - min) * math.clamp(relativeX, 0, 1)
            updateValue(value)
        end
    end)
    
    SliderContainer.Parent = parent
    
    return {
        Set = function(value)
            updateValue(value)
        end,
        Get = function()
            return currentValue
        end
    }
end

-- Функция для создания Dropdown
local function createDropdown(parent, title, values, defaultValue, callback)
    local DropdownContainer = Instance.new("Frame")
    DropdownContainer.Name = "DropdownContainer_" .. title
    DropdownContainer.Size = UDim2.new(1, 0, 0, 30)
    DropdownContainer.BackgroundTransparency = 1
    DropdownContainer.LayoutOrder = #parent:GetChildren()
    DropdownContainer.ClipsDescendants = true
    
    local DropdownLabel = Instance.new("TextLabel")
    DropdownLabel.Name = "DropdownLabel"
    DropdownLabel.Size = UDim2.new(0.7, 0, 1, 0)
    DropdownLabel.BackgroundTransparency = 1
    DropdownLabel.Text = title
    DropdownLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    DropdownLabel.Font = Enum.Font.Gotham
    DropdownLabel.TextSize = 14
    DropdownLabel.TextXAlignment = Enum.TextXAlignment.Left
    DropdownLabel.Parent = DropdownContainer
    
    local DropdownButton = Instance.new("TextButton")
    DropdownButton.Name = "DropdownButton"
    DropdownButton.Size = UDim2.new(0, 120, 0, 30)
    DropdownButton.Position = UDim2.new(1, -120, 0, 0)
    DropdownButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
    DropdownButton.BorderSizePixel = 0
    DropdownButton.Text = defaultValue
    DropdownButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    DropdownButton.Font = Enum.Font.Gotham
    DropdownButton.TextSize = 14
    DropdownButton.Parent = DropdownContainer
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 6)
    ButtonCorner.Parent = DropdownButton
    
    local DropdownList = Instance.new("Frame")
    DropdownList.Name = "DropdownList"
    DropdownList.Size = UDim2.new(0, 120, 0, 0)
    DropdownList.Position = UDim2.new(1, -120, 1, 5)
    DropdownList.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
    DropdownList.BorderSizePixel = 0
    DropdownList.Visible = false
    DropdownList.ZIndex = 5
    DropdownList.Parent = DropdownContainer
    
    local ListCorner = Instance.new("UICorner")
    ListCorner.CornerRadius = UDim.new(0, 6)
    ListCorner.Parent = DropdownList
    
    local ListLayout = Instance.new("UIListLayout")
    ListLayout.Padding = UDim.new(0, 2)
    ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ListLayout.Parent = DropdownList
    
    local currentValue = defaultValue
    local isOpen = false
    
    local function updateDropdownSize()
        DropdownList.Size = UDim2.new(0, 120, 0, #values * 32)
    end
    
    local function closeDropdown()
        isOpen = false
        DropdownList.Visible = false
        DropdownContainer.Size = UDim2.new(1, 0, 0, 30)
    end
    
    local function selectValue(value)
        currentValue = value
        DropdownButton.Text = value
        closeDropdown()
        
        if callback then
            callback(value)
        end
    end
    
    for _, value in ipairs(values) do
        local OptionButton = Instance.new("TextButton")
        OptionButton.Name = "Option_" .. value
        OptionButton.Size = UDim2.new(1, -10, 0, 30)
        OptionButton.Position = UDim2.new(0, 5, 0, 0)
        OptionButton.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
        OptionButton.BorderSizePixel = 0
        OptionButton.Text = value
        OptionButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        OptionButton.Font = Enum.Font.Gotham
        OptionButton.TextSize = 14
        OptionButton.ZIndex = 6
        OptionButton.Parent = DropdownList
        
        local OptionCorner = Instance.new("UICorner")
        OptionCorner.CornerRadius = UDim.new(0, 4)
        OptionCorner.Parent = OptionButton
        
        OptionButton.MouseButton1Click:Connect(function()
            selectValue(value)
        end)
        
        OptionButton.MouseEnter:Connect(function()
            OptionButton.BackgroundColor3 = Color3.fromRGB(70, 70, 90)
        end)
        
        OptionButton.MouseLeave:Connect(function()
            OptionButton.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
        end)
    end
    
    updateDropdownSize()
    
    DropdownButton.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        DropdownList.Visible = isOpen
        DropdownContainer.Size = isOpen and UDim2.new(1, 0, 0, 30 + DropdownList.AbsoluteSize.Y + 5) or UDim2.new(1, 0, 0, 30)
    end)
    
    DropdownContainer.Parent = parent
    
    return {
        Set = function(value)
            if table.find(values, value) then
                selectValue(value)
            end
        end,
        Get = function()
            return currentValue
        end
    }
end

-- Функция для создания Keybind
local function createKeybind(parent, title, defaultKey, callback)
    local KeybindContainer = Instance.new("Frame")
    KeybindContainer.Name = "KeybindContainer_" .. title
    KeybindContainer.Size = UDim2.new(1, 0, 0, 30)
    KeybindContainer.BackgroundTransparency = 1
    KeybindContainer.LayoutOrder = #parent:GetChildren()
    
    local KeybindLabel = Instance.new("TextLabel")
    KeybindLabel.Name = "KeybindLabel"
    KeybindLabel.Size = UDim2.new(0.7, 0, 1, 0)
    KeybindLabel.BackgroundTransparency = 1
    KeybindLabel.Text = title
    KeybindLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    KeybindLabel.Font = Enum.Font.Gotham
    KeybindLabel.TextSize = 14
    KeybindLabel.TextXAlignment = Enum.TextXAlignment.Left
    KeybindLabel.Parent = KeybindContainer
    
    local KeybindButton = Instance.new("TextButton")
    KeybindButton.Name = "KeybindButton"
    KeybindButton.Size = UDim2.new(0, 80, 0, 30)
    KeybindButton.Position = UDim2.new(1, -80, 0, 0)
    KeybindButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
    KeybindButton.BorderSizePixel = 0
    KeybindButton.Text = tostring(defaultKey):gsub("Enum.KeyCode.", "")
    KeybindButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    KeybindButton.Font = Enum.Font.Gotham
    KeybindButton.TextSize = 14
    KeybindButton.Parent = KeybindContainer
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 6)
    ButtonCorner.Parent = KeybindButton
    
    local listening = false
    local currentKey = defaultKey
    
    KeybindButton.MouseButton1Click:Connect(function()
        listening = true
        KeybindButton.Text = "..."
        KeybindButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    end)
    
    UserInputService.InputBegan:Connect(function(input)
        if listening and input.UserInputType == Enum.UserInputType.Keyboard then
            listening = false
            currentKey = input.KeyCode
            KeybindButton.Text = tostring(input.KeyCode):gsub("Enum.KeyCode.", "")
            KeybindButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
            
            if callback then
                callback(input.KeyCode)
            end
        end
    end)
    
    KeybindContainer.Parent = parent
    
    return {
        Set = function(key)
            currentKey = key
            KeybindButton.Text = tostring(key):gsub("Enum.KeyCode.", "")
        end,
        Get = function()
            return currentKey
        end
    }
end

-- Создаем групбоксы
local TeleportGroup, TeleportContainer = createGroupbox("Телепортация", "Left", UDim2.new(0.95, 0, 0, 150))
TeleportGroup.Parent = ScrollingFrame

local OffsetGroup, OffsetContainer = createGroupbox("Настройка координат", "Right", UDim2.new(0.95, 0, 0, 200))
OffsetGroup.Parent = ScrollingFrame

local ModeGroup, ModeContainer = createGroupbox("Моды", "Left", UDim2.new(0.95, 0, 0, 200))
ModeGroup.Parent = ScrollingFrame

local KeybindGroup, KeybindContainer = createGroupbox("Контролер кнопки", "Right", UDim2.new(0.95, 0, 0, 100))
KeybindGroup.Parent = ScrollingFrame

-- Создаем элементы управления
local teleportToggle = createToggle(TeleportContainer, "Включить тп", false, function(value)
    teleportEnabled = value
    
    if value then
        createNotification("Teleport", "Teleportation enabled!", 2)
        startTeleportation()
    else
        if teleportLoop then
            task.cancel(teleportLoop)
            teleportLoop = nil
        end
        isTeleporting = false
        currentTarget = nil
        createNotification("Teleport", "Teleportation disabled!", 2)
    end
end)

local teleportDelaySlider = createSlider(TeleportContainer, "Скорость телепортации", 0.1, 5, 1, " sec", function(value)
    teleportDelay = value
end)

local xOffsetSlider = createSlider(OffsetContainer, "Лево право", -50, 50, 0, " studs", function(value)
    offset = Vector3.new(value, offset.Y, offset.Z)
end)

local yOffsetSlider = createSlider(OffsetContainer, "верх вниз", -50, 50, 0, " studs", function(value)
    offset = Vector3.new(offset.X, value, offset.Z)
end)

local zOffsetSlider = createSlider(OffsetContainer, "назад веред", -50, 50, 0, " studs", function(value)
    offset = Vector3.new(offset.X, offset.Y, value)
end)

local modeDropdown = createDropdown(ModeContainer, "Телепорт мод", {"Teleport", "Fly"}, "Teleport", function(value)
    teleportMode = value
end)

local flySpeedSlider = createSlider(ModeContainer, "Флай скорость", 10, 200, 50, " studs/sec", function(value)
    flySpeed = value
end)

local faceTargetToggle = createToggle(ModeContainer, "Поворот к игроку", false, function(value)
    faceTarget = value
    createNotification("Face Target", value and "Enabled - Will face same direction as target" or "Disabled", 2)
end)

local keybindButton = createKeybind(KeybindContainer, "Кнопка вклучения", Enum.KeyCode.T, function(key)
    teleportKeybind = key
    createNotification("Keybind", "Key set to: " .. tostring(key):gsub("Enum.KeyCode.", ""), 2)
end)

-- Функция для уведомлений
function createNotification(title, message, duration)
    local Notification = Instance.new("Frame")
    Notification.Name = "Notification"
    Notification.Size = UDim2.new(0, 300, 0, 80)
    Notification.Position = UDim2.new(1, -320, 1, -100)
    Notification.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
    Notification.BorderSizePixel = 0
    Notification.ZIndex = 1000000
    Notification.Parent = ScreenGui
    
    local NotifCorner = Instance.new("UICorner")
    NotifCorner.CornerRadius = UDim.new(0, 8)
    NotifCorner.Parent = Notification
    
    local NotifStroke = Instance.new("UIStroke")
    NotifStroke.Color = Color3.fromRGB(0, 170, 255)
    NotifStroke.Thickness = 2
    NotifStroke.Parent = Notification
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, -20, 0, 30)
    TitleLabel.Position = UDim2.new(0, 10, 0, 5)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = title
    TitleLabel.TextColor3 = Color3.fromRGB(0, 170, 255)
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextSize = 16
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = Notification
    
    local MessageLabel = Instance.new("TextLabel")
    MessageLabel.Size = UDim2.new(1, -20, 1, -40)
    MessageLabel.Position = UDim2.new(0, 10, 0, 35)
    MessageLabel.BackgroundTransparency = 1
    MessageLabel.Text = message
    MessageLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    MessageLabel.Font = Enum.Font.Gotham
    MessageLabel.TextSize = 14
    MessageLabel.TextXAlignment = Enum.TextXAlignment.Left
    MessageLabel.TextYAlignment = Enum.TextYAlignment.Top
    MessageLabel.TextWrapped = true
    MessageLabel.Parent = Notification
    
    task.spawn(function()
        task.wait(duration or 3)
        local tween = TweenService:Create(Notification, TweenInfo.new(0.5), {Position = UDim2.new(1, -320, 1, 100)})
        tween:Play()
        tween.Completed:Wait()
        Notification:Destroy()
    end)
end

-- Функции для телепортации (из оригинального скрипта)
local function updatePlayerList()
    playerList = {}
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            table.insert(playerList, player)
        end
    end
end

local function getPlayerPosition(player)
    if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local targetCFrame = player.Character.HumanoidRootPart.CFrame
        local offsetCFrame = CFrame.new(offset.X, offset.Y, offset.Z)
        return (targetCFrame * offsetCFrame).Position
    end
    return nil
end

local function isValidPlayer(player)
    return player and player.Character and player.Character:FindFirstChild("HumanoidRootPart")
end

local function getTargetLookDirection(targetPlayer)
    if not isValidPlayer(targetPlayer) then return nil end
    return targetPlayer.Character.HumanoidRootPart.CFrame.LookVector
end

local function alignWithTarget(targetPlayer)
    if not faceTarget then return end
    if not isValidPlayer(targetPlayer) then return end
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
    local charRoot = LocalPlayer.Character.HumanoidRootPart
    local targetRoot = targetPlayer.Character.HumanoidRootPart
    local targetLookVector = targetRoot.CFrame.LookVector
    local targetPosition = targetRoot.Position
    local charPosition = charRoot.Position
    local lookAtPosition = targetPosition + (targetLookVector * 10)
    charRoot.CFrame = CFrame.new(charPosition, charPosition + targetLookVector)
    local camera = Workspace.CurrentCamera
    if camera then
        local cameraDistance = 10
        local cameraHeight = 3
        local cameraOffset = Vector3.new(0, cameraHeight, cameraDistance)
        local upVector = Vector3.new(0, 1, 0)
        local rightVector = targetLookVector:Cross(upVector).Unit
        local actualUpVector = rightVector:Cross(targetLookVector).Unit
        local cameraCFrame = CFrame.fromMatrix(charPosition + Vector3.new(0, cameraHeight, 0), 
                                             rightVector, actualUpVector, -targetLookVector)
        local cameraLookAt = charPosition + (targetLookVector * 100)
        camera.CFrame = CFrame.new(cameraCFrame.Position, cameraLookAt)
    end
end

local function goToTarget(targetPlayer)
    if not isValidPlayer(targetPlayer) then
        return false
    end
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        return false
    end
    isTeleporting = true
    currentTarget = targetPlayer
    if teleportMode == "Teleport" then
        local startTime = tick()
        while tick() - startTime < teleportDelay and teleportEnabled do
            RunService.Heartbeat:Wait()
        end
        if teleportEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local targetPosition = getPlayerPosition(targetPlayer)
            if targetPosition then
                LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
                if faceTarget then
                    alignWithTarget(targetPlayer)
                end
                isTeleporting = false
                return true
            end
        end
    else
        local startTime = tick()  
        while teleportEnabled and isValidPlayer(targetPlayer) and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") do
            local currentTargetPosition = getPlayerPosition(targetPlayer)
            if not currentTargetPosition then break end
            local currentPosition = LocalPlayer.Character.HumanoidRootPart.Position
            local direction = (currentTargetPosition - currentPosition)
            local distance = direction.Magnitude
            if faceTarget then
                alignWithTarget(targetPlayer)
            end
            if distance < 2 then
                break
            end
            local step = math.min(distance, flySpeed * RunService.Heartbeat:Wait())
            local newPosition = currentPosition + (direction.Unit * step)
            LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(newPosition)
            RunService.Heartbeat:Wait()
            if tick() - startTime > 10 then
                break
            end
        end
        if teleportEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local finalPosition = getPlayerPosition(targetPlayer)
            if finalPosition then
                LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(finalPosition)
                if faceTarget then
                    alignWithTarget(targetPlayer)
                end
            end
        end
    end
    isTeleporting = false
    return false
end

function startTeleportation()
    if teleportLoop then
        task.cancel(teleportLoop)
        teleportLoop = nil
    end
    updatePlayerList()
    if #playerList == 0 then
        createNotification("Teleport", "No other players found!", 3)
        teleportEnabled = false
        teleportToggle.Set(false)
        return
    end
    teleportLoop = task.spawn(function()
        while teleportEnabled do
            updatePlayerList()
            if #playerList == 0 then
                task.wait(1)
                continue
            end
            for i = #playerList, 2, -1 do
                local j = math.random(i)
                playerList[i], playerList[j] = playerList[j], playerList[i]
            end
            for _, targetPlayer in ipairs(playerList) do
                if not teleportEnabled then break end
                if isValidPlayer(targetPlayer) then
                    goToTarget(targetPlayer)
                end
                while isTeleporting and teleportEnabled do
                    task.wait()
                end
                if not teleportEnabled then break end
            end
        end
    end)
end

-- Функционал перемещения GUI
local dragging = false
local dragInput, dragStart, startPos

local function updateInput(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TitleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        updateInput(input)
    end
end)

-- Функционал кнопок
local isMinimized = false
local originalSize = MainFrame.Size

MinimizeButton.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    if isMinimized then
        MainFrame:TweenSize(UDim2.new(0, 450, 0, 40), "Out", "Quad", 0.3, true)
        MinimizeButton.Text = "□"
    else
        MainFrame:TweenSize(originalSize, "Out", "Quad", 0.3, true)
        MinimizeButton.Text = "_"
    end
end)

CloseButton.MouseButton1Click:Connect(function()
    if teleportLoop then
        task.cancel(teleportLoop)
        teleportLoop = nil
    end
    ScreenGui:Destroy()
end)

CloseButton.MouseEnter:Connect(function()
    CloseButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
end)

CloseButton.MouseLeave:Connect(function()
    CloseButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
end)

MinimizeButton.MouseEnter:Connect(function()
    MinimizeButton.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
end)

MinimizeButton.MouseLeave:Connect(function()
    MinimizeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
end)

-- Обновление размера ScrollingFrame
UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y + 20)
end)

-- Горячая клавиша для телепортации
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == teleportKeybind then
        teleportToggle.Set(not teleportToggle.Get())
    end
end)

-- Создаем уведомление о загрузке
task.spawn(function()
    task.wait(0.5)
    createNotification("Teleport GUI", "GUI loaded successfully! Press " .. tostring(teleportKeybind):gsub("Enum.KeyCode.", "") .. " to toggle teleport", 5)
end)
