-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

-- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª–µ—Ç–∞
local flyEnabled = false
local vflyEnabled = false
local flyConnection = nil
local vflyConnection = nil

local flySettings = {
    speed = 50,
    keybind = Enum.KeyCode.KeypadZero
}
local vflySettings = {
    speed = 600,
    acceleration = 4,
    turnSpeed = 16,
    speedMultiplier = 3,
    keybind = Enum.KeyCode.KeypadZero,
    speedKey = Enum.KeyCode.LeftControl
}
local CurrentVelocity = Vector3.new(0,0,0)
local UserRootPart = nil

-- GUI –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
local GuiEnabled = true
local ScreenGui = nil
local MainFrame = nil
local TabButtons = {}
local TabContents = {}
local CurrentTab = "Fly"

-- –°—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã UI
local UIReferences = {
    FlyToggle = nil,
    VFlyToggle = nil,
    FlySpeedSlider = {valueLabel = nil, fill = nil, thumb = nil},
    VFlySpeedSlider = {valueLabel = nil, fill = nil, thumb = nil},
    VFlyAccelSlider = {valueLabel = nil, fill = nil, thumb = nil},
    VFlyTurnSlider = {valueLabel = nil, fill = nil, thumb = nil},
    VFlyMultiplierSlider = {valueLabel = nil, fill = nil, thumb = nil},
    FlyKeybindButton = nil,
    VFlyKeybindButton = nil,
    BoostKeyButton = nil
}

-- –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
local settingsFolder = "1qluaseting"
local settingsFile = "SETINGFLY.json"

-- –§—É–Ω–∫—Ü–∏–∏ –ø–æ–ª–µ—Ç–∞
local function FlyFunction()
    if not LocalPlayer.Character then return end
    local humanoid = LocalPlayer.Character:FindFirstChild("Humanoid")
    local rootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not rootPart then return end
    local direction = Vector3.new(0, 0, 0)
    if UserInputService:IsKeyDown(Enum.KeyCode.W) then
        direction = direction + workspace.CurrentCamera.CFrame.LookVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then
        direction = direction - workspace.CurrentCamera.CFrame.LookVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then
        direction = direction - workspace.CurrentCamera.CFrame.RightVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then
        direction = direction + workspace.CurrentCamera.CFrame.RightVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
        direction = direction + Vector3.new(0, 1, 0)
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
        direction = direction + Vector3.new(0, -1, 0)
    end
    if direction.Magnitude > 0 then
        direction = direction.Unit * flySettings.speed
    end
    rootPart.Velocity = Vector3.new(direction.X, direction.Y, direction.Z)
end

local function VFlyFlight(delta)
    if not vflyEnabled or not UserRootPart then return end
    
    local BaseVelocity = Vector3.new(0,0,0)
    local Camera = workspace.CurrentCamera
    if not UserInputService:GetFocusedTextBox() then
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then
            BaseVelocity = BaseVelocity + (Camera.CFrame.LookVector * vflySettings.speed)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then
            BaseVelocity = BaseVelocity - (Camera.CFrame.RightVector * vflySettings.speed)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then
            BaseVelocity = BaseVelocity - (Camera.CFrame.LookVector * vflySettings.speed)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then
            BaseVelocity = BaseVelocity + (Camera.CFrame.RightVector * vflySettings.speed)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
            BaseVelocity = BaseVelocity + (Camera.CFrame.UpVector * vflySettings.speed)
        end
        if UserInputService:IsKeyDown(vflySettings.speedKey) then
            BaseVelocity = BaseVelocity * vflySettings.speedMultiplier
        end
    end
    local car = UserRootPart:GetRootPart()
    if car.Anchored then return end
    CurrentVelocity = CurrentVelocity:Lerp(
        BaseVelocity,
        math.clamp(delta * vflySettings.acceleration, 0, 1)
    )
    car.Velocity = CurrentVelocity + Vector3.new(0, 2, 0)
    if car ~= UserRootPart then
        car.RotVelocity = Vector3.new(0,0,0)
        car.CFrame = car.CFrame:Lerp(CFrame.lookAt(
            car.Position,
            car.Position + CurrentVelocity + Camera.CFrame.LookVector
        ), math.clamp(delta * vflySettings.turnSpeed, 0, 1))
    end
end

local function ToggleFly()
    flyEnabled = not flyEnabled
    if flyEnabled then
        if vflyEnabled then
            ToggleVFly()
        end
        flyConnection = RunService.Heartbeat:Connect(FlyFunction)
        StarterGui:SetCore("SendNotification",{
            Title = "üöÄ FLY",
            Text = "Fly has been enabled",
            Duration = 2
        })
        if UIReferences.FlyToggle then
            UIReferences.FlyToggle.Text = "ON"
            UIReferences.FlyToggle.BackgroundColor3 = Color3.fromRGB(80, 220, 140)
        end
    else
        if flyConnection then
            flyConnection:Disconnect()
            flyConnection = nil
        end
        if LocalPlayer.Character then
            local rootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if rootPart then
                rootPart.Velocity = Vector3.new(0, rootPart.Velocity.Y, 0)
            end
        end
        StarterGui:SetCore("SendNotification",{
            Title = "üöÄ FLY",
            Text = "Fly has been disabled",
            Duration = 2
        })
        if UIReferences.FlyToggle then
            UIReferences.FlyToggle.Text = "OFF"
            UIReferences.FlyToggle.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        end
    end
end

local function ToggleVFly()
    vflyEnabled = not vflyEnabled
    if vflyEnabled then
        if flyEnabled then
            ToggleFly()
        end
        if LocalPlayer.Character then
            UserRootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if UserRootPart then
                CurrentVelocity = UserRootPart.Velocity
            end
        end
        vflyConnection = RunService.Heartbeat:Connect(VFlyFlight)
        StarterGui:SetCore("SendNotification",{
            Title = "‚ö° VFLY",
            Text = "V Fly has been enabled",
            Duration = 2
        })
        if UIReferences.VFlyToggle then
            UIReferences.VFlyToggle.Text = "ON"
            UIReferences.VFlyToggle.BackgroundColor3 = Color3.fromRGB(80, 220, 140)
        end
    else
        if vflyConnection then
            vflyConnection:Disconnect()
            vflyConnection = nil
        end
        StarterGui:SetCore("SendNotification",{
            Title = "‚ö° VFLY",
            Text = "V Fly has been disabled",
            Duration = 2
        })
        if UIReferences.VFlyToggle then
            UIReferences.VFlyToggle.Text = "OFF"
            UIReferences.VFlyToggle.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        end
    end
end

local function ProcessKeybind(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == flySettings.keybind then
        ToggleFly()
    end
    if input.KeyCode == vflySettings.keybind then
        ToggleVFly()
    end
end

-- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
local function ensureSettingsFolder()
    local success, result = pcall(function()
        if not isfolder then
            return false
        end
        
        if not isfolder(settingsFolder) then
            makefolder(settingsFolder)
        end
        return true
    end)
    
    return success and result
end

local function saveSettings()
    if not ensureSettingsFolder() then
        return false
    end
    
    local settingsData = {
        flyEnabled = flyEnabled,
        vflyEnabled = vflyEnabled,
        flySettings = flySettings,
        vflySettings = vflySettings,
        windowPosition = {
            X = MainFrame.Position.X.Scale,
            Y = MainFrame.Position.Y.Scale,
            OffsetX = MainFrame.Position.X.Offset,
            OffsetY = MainFrame.Position.Y.Offset
        }
    }
    
    -- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º KeyCodes –≤ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    settingsData.flySettings.keybind = tostring(flySettings.keybind)
    settingsData.vflySettings.keybind = tostring(vflySettings.keybind)
    settingsData.vflySettings.speedKey = tostring(vflySettings.speedKey)
    
    local json = HttpService:JSONEncode(settingsData)
    
    local success, errorMsg = pcall(function()
        writefile(settingsFolder .. "/" .. settingsFile, json)
    end)
    
    return success
end

local function loadSettings()
    if not ensureSettingsFolder() then
        return false
    end
    
    if not isfile then
        return false
    end
    
    if not isfile(settingsFolder .. "/" .. settingsFile) then
        return false
    end
    
    local success, result = pcall(function()
        local json = readfile(settingsFolder .. "/" .. settingsFile)
        return HttpService:JSONDecode(json)
    end)
    
    if success and result then
        -- –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª–µ—Ç–∞
        if result.flyEnabled ~= nil then
            flyEnabled = result.flyEnabled
        end
        if result.vflyEnabled ~= nil then
            vflyEnabled = result.vflyEnabled
        end
        
        if result.flySettings then
            flySettings.speed = result.flySettings.speed or 50
            if result.flySettings.keybind then
                local keyName = result.flySettings.keybind:gsub("Enum.KeyCode.", "")
                local success, key = pcall(function()
                    return Enum.KeyCode[keyName]
                end)
                if success then
                    flySettings.keybind = key
                end
            end
        end
        
        if result.vflySettings then
            vflySettings.speed = result.vflySettings.speed or 600
            vflySettings.acceleration = result.vflySettings.acceleration or 4
            vflySettings.turnSpeed = result.vflySettings.turnSpeed or 16
            vflySettings.speedMultiplier = result.vflySettings.speedMultiplier or 3
            
            if result.vflySettings.keybind then
                local keyName = result.vflySettings.keybind:gsub("Enum.KeyCode.", "")
                local success, key = pcall(function()
                    return Enum.KeyCode[keyName]
                end)
                if success then
                    vflySettings.keybind = key
                end
            end
            
            if result.vflySettings.speedKey then
                local keyName = result.vflySettings.speedKey:gsub("Enum.KeyCode.", "")
                local success, key = pcall(function()
                    return Enum.KeyCode[keyName]
                end)
                if success then
                    vflySettings.speedKey = key
                end
            end
        end
        
        if result.windowPosition and MainFrame then
            MainFrame.Position = UDim2.new(
                result.windowPosition.X or 0.5,
                result.windowPosition.OffsetX or -250,
                result.windowPosition.Y or 0.5,
                result.windowPosition.OffsetY or -325
            )
        end
        
        return true
    end
    return false
end

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
local function setupButtonHover(button, hoverColor, normalColor)
    if not button then return end
    local hoverColor = hoverColor or button.BackgroundColor3
    local normalColor = normalColor or button.BackgroundColor3
    
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = hoverColor}):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = normalColor}):Play()
    end)
end

-- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ GUI
local function updateSliderVisual(sliderRef, value, min, max)
    if not sliderRef or not sliderRef.fill or not sliderRef.thumb or not sliderRef.valueLabel then
        return
    end
    
    local normalized = math.clamp((value - min) / (max - min), 0, 1)
    sliderRef.fill.Size = UDim2.new(normalized, 0, 1, 0)
    sliderRef.thumb.Position = UDim2.new(normalized, -10, 0.5, -10)
    sliderRef.valueLabel.Text = tostring(math.floor(value))
end

local function updateUIFromSettings()
    -- –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π
    if UIReferences.FlyToggle then
        UIReferences.FlyToggle.Text = flyEnabled and "ON" or "OFF"
        UIReferences.FlyToggle.BackgroundColor3 = flyEnabled and Color3.fromRGB(80, 220, 140) or Color3.fromRGB(200, 60, 60)
    end
    
    if UIReferences.VFlyToggle then
        UIReferences.VFlyToggle.Text = vflyEnabled and "ON" or "OFF"
        UIReferences.VFlyToggle.BackgroundColor3 = vflyEnabled and Color3.fromRGB(80, 220, 140) or Color3.fromRGB(200, 60, 60)
    end
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–∞–π–¥–µ—Ä—ã
    if UIReferences.FlySpeedSlider then
        updateSliderVisual(UIReferences.FlySpeedSlider, flySettings.speed, 16, 250)
    end
    
    if UIReferences.VFlySpeedSlider then
        updateSliderVisual(UIReferences.VFlySpeedSlider, vflySettings.speed, 100, 2000)
    end
    
    if UIReferences.VFlyAccelSlider then
        updateSliderVisual(UIReferences.VFlyAccelSlider, vflySettings.acceleration, 1, 20)
    end
    
    if UIReferences.VFlyTurnSlider then
        updateSliderVisual(UIReferences.VFlyTurnSlider, vflySettings.turnSpeed, 1, 50)
    end
    
    if UIReferences.VFlyMultiplierSlider then
        updateSliderVisual(UIReferences.VFlyMultiplierSlider, vflySettings.speedMultiplier, 2, 10)
    end
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∫–ª–∞–≤–∏—à
    if UIReferences.FlyKeybindButton then
        UIReferences.FlyKeybindButton.Text = tostring(flySettings.keybind):gsub("Enum.KeyCode.", "")
    end
    
    if UIReferences.VFlyKeybindButton then
        UIReferences.VFlyKeybindButton.Text = tostring(vflySettings.keybind):gsub("Enum.KeyCode.", "")
    end
    
    if UIReferences.BoostKeyButton then
        UIReferences.BoostKeyButton.Text = tostring(vflySettings.speedKey):gsub("Enum.KeyCode.", "")
    end
end

-- –§—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ GUI
local function createToggleButton(parent, name, default, position, callback)
    local container = Instance.new("Frame")
    container.Name = name
    container.Position = position
    container.Size = UDim2.new(1, -30, 0, 50)
    container.BackgroundTransparency = 1
    container.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Name = name .. "Label"
    label.Text = "–í–∫–ª—é—á–∏—Ç—å " .. name:gsub("Toggle", "")
    label.Size = UDim2.new(0.6, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 16
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = container
    
    local toggle = Instance.new("TextButton")
    toggle.Name = name .. "Button"
    toggle.Text = default and "ON" or "OFF"
    toggle.Size = UDim2.new(0, 100, 0, 40)
    toggle.Position = UDim2.new(1, -100, 0.5, -20)
    toggle.BackgroundColor3 = default and Color3.fromRGB(80, 220, 140) or Color3.fromRGB(200, 60, 60)
    toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggle.TextSize = 14
    toggle.Font = Enum.Font.GothamBold
    toggle.Parent = container
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = toggle
    
    setupButtonHover(toggle, 
        default and Color3.fromRGB(90, 240, 160) or Color3.fromRGB(220, 80, 80),
        default and Color3.fromRGB(80, 220, 140) or Color3.fromRGB(200, 60, 60))
    
    toggle.MouseButton1Click:Connect(function()
        callback()
    end)
    
    -- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É
    if name == "FlyToggle" then
        UIReferences.FlyToggle = toggle
    elseif name == "VFlyToggle" then
        UIReferences.VFlyToggle = toggle
    end
    
    return toggle
end

local function createSlider(parent, name, min, max, default, position, callback, sliderRefName)
    local container = Instance.new("Frame")
    container.Name = name
    container.Position = position
    container.Size = UDim2.new(1, -30, 0, 70)
    container.BackgroundTransparency = 1
    container.Parent = parent
    
    local topFrame = Instance.new("Frame")
    topFrame.Size = UDim2.new(1, 0, 0, 30)
    topFrame.BackgroundTransparency = 1
    topFrame.Parent = container
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Text = name
    nameLabel.Size = UDim2.new(0.6, 0, 1, 0)
    nameLabel.Position = UDim2.new(0, 0, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextSize = 16
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Parent = topFrame
    
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Name = name .. "Value"
    valueLabel.Text = tostring(default)
    valueLabel.Size = UDim2.new(0.4, 0, 1, 0)
    valueLabel.Position = UDim2.new(0.6, 0, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.TextColor3 = Color3.fromRGB(180, 180, 200)
    valueLabel.TextSize = 16
    valueLabel.Font = Enum.Font.Gotham
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.Parent = topFrame
    
    local sliderContainer = Instance.new("Frame")
    sliderContainer.Size = UDim2.new(1, 0, 0, 25)
    sliderContainer.Position = UDim2.new(0, 0, 0, 40)
    sliderContainer.BackgroundTransparency = 1
    sliderContainer.Parent = container
    
    local background = Instance.new("Frame")
    background.Size = UDim2.new(1, 0, 0, 10)
    background.Position = UDim2.new(0, 0, 0.5, -5)
    background.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
    background.BorderSizePixel = 0
    background.Parent = sliderContainer
    
    local bgCorner = Instance.new("UICorner")
    bgCorner.CornerRadius = UDim.new(1, 0)
    bgCorner.Parent = background
    
    local fill = Instance.new("Frame")
    fill.Name = "Fill"
    fill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    fill.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
    fill.BorderSizePixel = 0
    fill.Parent = background
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(1, 0)
    fillCorner.Parent = fill
    
    local thumb = Instance.new("Frame")
    thumb.Name = "Thumb"
    thumb.Size = UDim2.new(0, 20, 0, 20)
    thumb.Position = UDim2.new((default - min) / (max - min), -10, 0.5, -10)
    thumb.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    thumb.BorderSizePixel = 0
    thumb.Parent = sliderContainer
    
    local thumbCorner = Instance.new("UICorner")
    thumbCorner.CornerRadius = UDim.new(1, 0)
    thumbCorner.Parent = thumb
    
    local dragging = false
    
    local function updateSlider(value)
        local normalized = math.clamp((value - min) / (max - min), 0, 1)
        fill.Size = UDim2.new(normalized, 0, 1, 0)
        thumb.Position = UDim2.new(normalized, -10, 0.5, -10)
        valueLabel.Text = tostring(math.floor(value))
        callback(value)
    end
    
    sliderContainer.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            local x = input.Position.X - background.AbsolutePosition.X
            local normalized = math.clamp(x / background.AbsoluteSize.X, 0, 1)
            local value = min + (max - min) * normalized
            updateSlider(value)
            TweenService:Create(thumb, TweenInfo.new(0.2), {Size = UDim2.new(0, 24, 0, 24)}):Play()
        end
    end)
    
    sliderContainer.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
            TweenService:Create(thumb, TweenInfo.new(0.2), {Size = UDim2.new(0, 20, 0, 20)}):Play()
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local x = input.Position.X - background.AbsolutePosition.X
            local normalized = math.clamp(x / background.AbsoluteSize.X, 0, 1)
            local value = min + (max - min) * normalized
            updateSlider(value)
        end
    end)
    
    -- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ª–∞–π–¥–µ—Ä–∞
    if sliderRefName then
        UIReferences[sliderRefName] = {
            valueLabel = valueLabel,
            fill = fill,
            thumb = thumb
        }
    end
    
    -- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    updateSlider(default)
    
    return container
end

local function createKeybindButton(parent, name, defaultKey, position, callback, buttonRefName)
    local container = Instance.new("Frame")
    container.Name = name
    container.Position = position
    container.Size = UDim2.new(1, -30, 0, 50)
    container.BackgroundTransparency = 1
    container.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Text = name
    label.Size = UDim2.new(0.6, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 16
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = container
    
    local button = Instance.new("TextButton")
    button.Name = name .. "Button"
    button.Text = tostring(defaultKey):gsub("Enum.KeyCode.", "")
    button.Size = UDim2.new(0, 150, 0, 40)
    button.Position = UDim2.new(1, -150, 0.5, -20)
    button.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 14
    button.Font = Enum.Font.GothamBold
    button.AutoButtonColor = false
    button.Parent = container
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button
    
    setupButtonHover(button, Color3.fromRGB(50, 50, 70), Color3.fromRGB(40, 40, 55))
    
    local listening = false
    
    button.MouseButton1Click:Connect(function()
        listening = true
        button.Text = "Press any key..."
        button.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
        
        local connection
        connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
            if not gameProcessed and (input.UserInputType == Enum.UserInputType.Keyboard) then
                listening = false
                connection:Disconnect()
                button.Text = tostring(input.KeyCode):gsub("Enum.KeyCode.", "")
                button.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
                callback(input.KeyCode)
                
                -- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                TweenService:Create(button, TweenInfo.new(0.1), {Size = UDim2.new(0, 160, 0, 45)}):Play()
                wait(0.1)
                TweenService:Create(button, TweenInfo.new(0.1), {Size = UDim2.new(0, 150, 0, 40)}):Play()
            end
        end)
        
        -- –û—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        delay(5, function()
            if listening then
                listening = false
                connection:Disconnect()
                button.Text = tostring(defaultKey):gsub("Enum.KeyCode.", "")
                button.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
            end
        end)
    end)
    
    -- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É
    if buttonRefName then
        UIReferences[buttonRefName] = button
    end
    
    return button
end

local function SwitchTab(tabName)
    if CurrentTab == tabName then return end
    
    -- –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É
    if TabContents[CurrentTab] then
        TabContents[CurrentTab].Visible = false
        if TabButtons[CurrentTab] then
            TabButtons[CurrentTab].BackgroundColor3 = Color3.fromRGB(60, 60, 80)
            TabButtons[CurrentTab].TextColor3 = Color3.fromRGB(200, 200, 200)
        end
    end
    
    -- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É
    CurrentTab = tabName
    if TabContents[tabName] then
        TabContents[tabName].Visible = true
        if TabButtons[tabName] then
            TabButtons[tabName].BackgroundColor3 = Color3.fromRGB(80, 140, 220)
            TabButtons[tabName].TextColor3 = Color3.fromRGB(255, 255, 255)
        end
    end
end

local function CreateGUI()
    -- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π GUI –µ—Å–ª–∏ –µ—Å—Ç—å
    if ScreenGui then
        ScreenGui:Destroy()
        ScreenGui = nil
    end
    
    -- –°–æ–∑–¥–∞–µ–º ScreenGui
    ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "FlyGUI"
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.DisplayOrder = 9999
    ScreenGui.Parent = game:GetService("CoreGui")
    
    -- –û—Å–Ω–æ–≤–Ω–æ–µ –æ–∫–Ω–æ
    MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 500, 0, 650)
    MainFrame.Position = UDim2.new(0.5, -250, 0.5, -325)
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    MainFrame.BorderSizePixel = 0
    MainFrame.ClipsDescendants = true
    MainFrame.Parent = ScreenGui
    
    -- –ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = MainFrame
    
    -- –¢–µ–Ω—å
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(70, 70, 90)
    UIStroke.Thickness = 2
    UIStroke.Parent = MainFrame
    
    -- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
    local TitleBar = Instance.new("Frame")
    TitleBar.Name = "TitleBar"
    TitleBar.Size = UDim2.new(1, 0, 0, 45)
    TitleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
    TitleBar.BorderSizePixel = 0
    TitleBar.Parent = MainFrame
    
    local UICorner2 = Instance.new("UICorner")
    UICorner2.CornerRadius = UDim.new(0, 12, 0, 0)
    UICorner2.Parent = TitleBar
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "TitleLabel"
    TitleLabel.Size = UDim2.new(0.7, 0, 1, 0)
    TitleLabel.Position = UDim2.new(0, 15, 0, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = "üöÄ –ü–ê–ù–ï–õ–¨ –ü–û–õ–ï–¢–ê"
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.TextSize = 18
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = TitleBar
    
    -- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞
    local CloseButton = Instance.new("TextButton")
    CloseButton.Name = "CloseButton"
    CloseButton.Size = UDim2.new(0, 32, 0, 32)
    CloseButton.Position = UDim2.new(1, -42, 0.5, -16)
    CloseButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    CloseButton.Text = "‚úï"
    CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseButton.TextSize = 18
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.Parent = TitleBar
    
    local UICorner3 = Instance.new("UICorner")
    UICorner3.CornerRadius = UDim.new(0, 6)
    UICorner3.Parent = CloseButton
    
    -- –í–∫–ª–∞–¥–∫–∏ (Fly / VFly)
    local TabsFrame = Instance.new("Frame")
    TabsFrame.Name = "TabsFrame"
    TabsFrame.Size = UDim2.new(1, -30, 0, 40)
    TabsFrame.Position = UDim2.new(0, 15, 0, 55)
    TabsFrame.BackgroundTransparency = 1
    TabsFrame.Parent = MainFrame
    
    local FlyTab = Instance.new("TextButton")
    FlyTab.Name = "FlyTab"
    FlyTab.Size = UDim2.new(0.5, -5, 1, 0)
    FlyTab.Position = UDim2.new(0, 0, 0, 0)
    FlyTab.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
    FlyTab.Text = "üöÄ –û–ë–´–ß–ù–´–ô"
    FlyTab.TextColor3 = Color3.fromRGB(255, 255, 255)
    FlyTab.TextSize = 14
    FlyTab.Font = Enum.Font.GothamBold
    FlyTab.Parent = TabsFrame
    
    local UICornerFly = Instance.new("UICorner")
    UICornerFly.CornerRadius = UDim.new(0, 6, 0, 0)
    UICornerFly.Parent = FlyTab
    
    local VFlyTab = Instance.new("TextButton")
    VFlyTab.Name = "VFlyTab"
    VFlyTab.Size = UDim2.new(0.5, -5, 1, 0)
    VFlyTab.Position = UDim2.new(0.5, 5, 0, 0)
    VFlyTab.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
    VFlyTab.Text = "‚ö° V-FLY"
    VFlyTab.TextColor3 = Color3.fromRGB(200, 200, 200)
    VFlyTab.TextSize = 14
    VFlyTab.Font = Enum.Font.GothamBold
    VFlyTab.Parent = TabsFrame
    
    local UICornerVFly = Instance.new("UICorner")
    UICornerVFly.CornerRadius = UDim.new(0, 6, 0, 0)
    UICornerVFly.Parent = VFlyTab
    
    TabButtons["Fly"] = FlyTab
    TabButtons["VFly"] = VFlyTab
    
    -- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤–∫–ª–∞–¥–æ–∫
    local ContentFrame = Instance.new("Frame")
    ContentFrame.Name = "ContentFrame"
    ContentFrame.Size = UDim2.new(1, -30, 1, -210)
    ContentFrame.Position = UDim2.new(0, 15, 0, 105)
    ContentFrame.BackgroundTransparency = 1
    ContentFrame.Parent = MainFrame
    
    -- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ Fly
    local FlyContent = Instance.new("ScrollingFrame")
    FlyContent.Name = "FlyContent"
    FlyContent.Size = UDim2.new(1, 0, 1, 0)
    FlyContent.Position = UDim2.new(0, 0, 0, 0)
    FlyContent.BackgroundTransparency = 1
    FlyContent.BorderSizePixel = 0
    FlyContent.ScrollBarThickness = 8
    FlyContent.ScrollBarImageColor3 = Color3.fromRGB(90, 90, 110)
    FlyContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
    FlyContent.CanvasSize = UDim2.new(0, 0, 0, 0)
    FlyContent.Visible = true
    FlyContent.Parent = ContentFrame
    
    TabContents["Fly"] = FlyContent
    
    -- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ VFly
    local VFlyContent = Instance.new("ScrollingFrame")
    VFlyContent.Name = "VFlyContent"
    VFlyContent.Size = UDim2.new(1, 0, 1, 0)
    VFlyContent.Position = UDim2.new(0, 0, 0, 0)
    VFlyContent.BackgroundTransparency = 1
    VFlyContent.BorderSizePixel = 0
    VFlyContent.ScrollBarThickness = 8
    VFlyContent.ScrollBarImageColor3 = Color3.fromRGB(90, 90, 110)
    VFlyContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
    VFlyContent.CanvasSize = UDim2.new(0, 0, 0, 0)
    VFlyContent.Visible = false
    VFlyContent.Parent = ContentFrame
    
    TabContents["VFly"] = VFlyContent
    
    -- –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ Fly
    createToggleButton(FlyContent, "FlyToggle", flyEnabled, UDim2.new(0, 15, 0, 20), function()
        ToggleFly()
    end)
    
    createSlider(FlyContent, "–°–∫–æ—Ä–æ—Å—Ç—å Fly", 16, 250, flySettings.speed, UDim2.new(0, 15, 0, 90), function(value)
        flySettings.speed = value
    end, "FlySpeedSlider")
    
    createKeybindButton(FlyContent, "–ö–ª–∞–≤–∏—à–∞ Fly", flySettings.keybind, UDim2.new(0, 15, 0, 180), function(key)
        flySettings.keybind = key
        StarterGui:SetCore("SendNotification",{
            Title = "üöÄ FLY",
            Text = "–ö–ª–∞–≤–∏—à–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: "..tostring(key):gsub("Enum.KeyCode.", ""),
            Duration = 2
        })
    end, "FlyKeybindButton")
    
    -- –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ VFly
    createToggleButton(VFlyContent, "VFlyToggle", vflyEnabled, UDim2.new(0, 15, 0, 20), function()
        ToggleVFly()
    end)
    
    createSlider(VFlyContent, "–°–∫–æ—Ä–æ—Å—Ç—å V-Fly", 100, 2000, vflySettings.speed, UDim2.new(0, 15, 0, 90), function(value)
        vflySettings.speed = value
    end, "VFlySpeedSlider")
    
    createSlider(VFlyContent, "–£—Å–∫–æ—Ä–µ–Ω–∏–µ", 1, 20, vflySettings.acceleration, UDim2.new(0, 15, 0, 180), function(value)
        vflySettings.acceleration = value
    end, "VFlyAccelSlider")
    
    createSlider(VFlyContent, "–ü–æ–≤–æ—Ä–æ—Ç", 1, 50, vflySettings.turnSpeed, UDim2.new(0, 15, 0, 270), function(value)
        vflySettings.turnSpeed = value
    end, "VFlyTurnSlider")
    
    createSlider(VFlyContent, "–ú–Ω–æ–∂–∏—Ç–µ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏", 2, 10, vflySettings.speedMultiplier, UDim2.new(0, 15, 0, 360), function(value)
        vflySettings.speedMultiplier = value
    end, "VFlyMultiplierSlider")
    
    createKeybindButton(VFlyContent, "–ö–ª–∞–≤–∏—à–∞ V-Fly", vflySettings.keybind, UDim2.new(0, 15, 0, 450), function(key)
        vflySettings.keybind = key
        StarterGui:SetCore("SendNotification",{
            Title = "‚ö° V-FLY",
            Text = "–ö–ª–∞–≤–∏—à–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: "..tostring(key):gsub("Enum.KeyCode.", ""),
            Duration = 2
        })
    end, "VFlyKeybindButton")
    
    createKeybindButton(VFlyContent, "–ö–ª–∞–≤–∏—à–∞ —É—Å–∫–æ—Ä–µ–Ω–∏—è", vflySettings.speedKey, UDim2.new(0, 15, 0, 520), function(key)
        vflySettings.speedKey = key
        StarterGui:SetCore("SendNotification",{
            Title = "‚ö° V-FLY",
            Text = "–ö–ª–∞–≤–∏—à–∞ —É—Å–∫–æ—Ä–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: "..tostring(key):gsub("Enum.KeyCode.", ""),
            Duration = 2
        })
    end, "BoostKeyButton")
    
    -- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    local ButtonsFrame = Instance.new("Frame")
    ButtonsFrame.Name = "ButtonsFrame"
    ButtonsFrame.Size = UDim2.new(1, -30, 0, 100)
    ButtonsFrame.Position = UDim2.new(0, 15, 1, -110)
    ButtonsFrame.BackgroundTransparency = 1
    ButtonsFrame.Parent = MainFrame
    
    -- –ü–µ—Ä–≤—ã–π —Ä—è–¥ –∫–Ω–æ–ø–æ–∫
    local ButtonsRow1 = Instance.new("Frame")
    ButtonsRow1.Size = UDim2.new(1, 0, 0, 45)
    ButtonsRow1.BackgroundTransparency = 1
    ButtonsRow1.Parent = ButtonsFrame
    
    local SaveButton = Instance.new("TextButton")
    SaveButton.Name = "SaveButton"
    SaveButton.Size = UDim2.new(0.48, 0, 1, 0)
    SaveButton.Position = UDim2.new(0, 0, 0, 0)
    SaveButton.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
    SaveButton.Text = "üíæ –°–û–•–†–ê–ù–ò–¢–¨"
    SaveButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    SaveButton.TextSize = 14
    SaveButton.Font = Enum.Font.GothamBold
    SaveButton.Parent = ButtonsRow1
    
    local UICornerSave = Instance.new("UICorner")
    UICornerSave.CornerRadius = UDim.new(0, 8)
    UICornerSave.Parent = SaveButton
    
    local LoadButton = Instance.new("TextButton")
    LoadButton.Name = "LoadButton"
    LoadButton.Size = UDim2.new(0.48, 0, 1, 0)
    LoadButton.Position = UDim2.new(0.52, 0, 0, 0)
    LoadButton.BackgroundColor3 = Color3.fromRGB(80, 220, 140)
    LoadButton.Text = "üìÇ –ó–ê–ì–†–£–ó–ò–¢–¨"
    LoadButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    LoadButton.TextSize = 14
    LoadButton.Font = Enum.Font.GothamBold
    LoadButton.Parent = ButtonsRow1
    
    local UICornerLoad = Instance.new("UICorner")
    UICornerLoad.CornerRadius = UDim.new(0, 8)
    UICornerLoad.Parent = LoadButton
    
    -- –í—Ç–æ—Ä–æ–π —Ä—è–¥ –∫–Ω–æ–ø–æ–∫
    local ButtonsRow2 = Instance.new("Frame")
    ButtonsRow2.Size = UDim2.new(1, 0, 0, 45)
    ButtonsRow2.Position = UDim2.new(0, 0, 0, 55)
    ButtonsRow2.BackgroundTransparency = 1
    ButtonsRow2.Parent = ButtonsFrame
    
    local InfoButton = Instance.new("TextButton")
    InfoButton.Name = "InfoButton"
    InfoButton.Size = UDim2.new(0.48, 0, 1, 0)
    InfoButton.Position = UDim2.new(0, 0, 0, 0)
    InfoButton.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
    InfoButton.Text = "‚ÑπÔ∏è –ò–ù–§–û"
    InfoButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    InfoButton.TextSize = 14
    InfoButton.Font = Enum.Font.GothamBold
    InfoButton.Parent = ButtonsRow2
    
    local UICornerInfo = Instance.new("UICorner")
    UICornerInfo.CornerRadius = UDim.new(0, 8)
    UICornerInfo.Parent = InfoButton
    
    local HideButton = Instance.new("TextButton")
    HideButton.Name = "HideButton"
    HideButton.Size = UDim2.new(0.48, 0, 1, 0)
    HideButton.Position = UDim2.new(0.52, 0, 0, 0)
    HideButton.BackgroundColor3 = Color3.fromRGB(180, 140, 60)
    HideButton.Text = "üëÅÔ∏è –°–ö–†–´–¢–¨"
    HideButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    HideButton.TextSize = 14
    HideButton.Font = Enum.Font.GothamBold
    HideButton.Parent = ButtonsRow2
    
    local UICornerHide = Instance.new("UICorner")
    UICornerHide.CornerRadius = UDim.new(0, 8)
    UICornerHide.Parent = HideButton
    
    -- –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –∫ –∫–Ω–æ–ø–∫–∞–º
    setupButtonHover(CloseButton, Color3.fromRGB(220, 80, 80), Color3.fromRGB(200, 60, 60))
    setupButtonHover(FlyTab, Color3.fromRGB(90, 160, 240), Color3.fromRGB(80, 140, 220))
    setupButtonHover(VFlyTab, Color3.fromRGB(80, 80, 100), Color3.fromRGB(60, 60, 80))
    setupButtonHover(SaveButton, Color3.fromRGB(90, 160, 240), Color3.fromRGB(80, 140, 220))
    setupButtonHover(LoadButton, Color3.fromRGB(90, 240, 160), Color3.fromRGB(80, 220, 140))
    setupButtonHover(InfoButton, Color3.fromRGB(90, 160, 240), Color3.fromRGB(80, 140, 220))
    setupButtonHover(HideButton, Color3.fromRGB(200, 160, 80), Color3.fromRGB(180, 140, 60))
    
    -- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∫–ª–∞–¥–æ–∫
    FlyTab.MouseButton1Click:Connect(function()
        SwitchTab("Fly")
    end)
    
    VFlyTab.MouseButton1Click:Connect(function()
        SwitchTab("VFly")
    end)
    
    -- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
    CloseButton.MouseButton1Click:Connect(function()
        GuiEnabled = false
        ScreenGui:Destroy()
        ScreenGui = nil
        
        -- –û—Ç–∫–ª—é—á–∞–µ–º –ø–æ–ª–µ—Ç—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ GUI
        if flyEnabled then
            ToggleFly()
        end
        if vflyEnabled then
            ToggleVFly()
        end
    end)
    
    -- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    SaveButton.MouseButton1Click:Connect(function()
        if saveSettings() then
            -- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            SaveButton.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
            SaveButton.Text = "‚úÖ –°–û–•–†–ê–ù–ï–ù–û!"
            
            wait(1)
            
            SaveButton.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
            SaveButton.Text = "üíæ –°–û–•–†–ê–ù–ò–¢–¨"
            
            setupButtonHover(SaveButton, Color3.fromRGB(90, 160, 240), Color3.fromRGB(80, 140, 220))
        else
            -- –ê–Ω–∏–º–∞—Ü–∏—è –æ—à–∏–±–∫–∏
            SaveButton.BackgroundColor3 = Color3.fromRGB(220, 100, 100)
            SaveButton.Text = "‚ùå –û–®–ò–ë–ö–ê!"
            
            wait(1)
            
            SaveButton.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
            SaveButton.Text = "üíæ –°–û–•–†–ê–ù–ò–¢–¨"
            
            setupButtonHover(SaveButton, Color3.fromRGB(90, 160, 240), Color3.fromRGB(80, 140, 220))
        end
    end)
    
    -- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    LoadButton.MouseButton1Click:Connect(function()
        if loadSettings() then
            updateUIFromSettings()
            
            -- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            LoadButton.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
            LoadButton.Text = "‚úÖ –ó–ê–ì–†–£–ñ–ï–ù–û!"
            
            wait(1)
            
            LoadButton.BackgroundColor3 = Color3.fromRGB(80, 220, 140)
            LoadButton.Text = "üìÇ –ó–ê–ì–†–£–ó–ò–¢–¨"
            
            setupButtonHover(LoadButton, Color3.fromRGB(90, 240, 160), Color3.fromRGB(80, 220, 140))
        else
            -- –ê–Ω–∏–º–∞—Ü–∏—è –æ—à–∏–±–∫–∏
            LoadButton.BackgroundColor3 = Color3.fromRGB(220, 100, 100)
            LoadButton.Text = "‚ùå –û–®–ò–ë–ö–ê!"
            
            wait(1)
            
            LoadButton.BackgroundColor3 = Color3.fromRGB(80, 220, 140)
            LoadButton.Text = "üìÇ –ó–ê–ì–†–£–ó–ò–¢–¨"
            
            setupButtonHover(LoadButton, Color3.fromRGB(90, 240, 160), Color3.fromRGB(80, 220, 140))
        end
    end)
    
    -- –ö–Ω–æ–ø–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    InfoButton.MouseButton1Click:Connect(function()
        StarterGui:SetCore("SendNotification",{
            Title = "üöÄ –ü–ê–ù–ï–õ–¨ –ü–û–õ–ï–¢–ê",
            Text = "Fly: WASD + Space/Shift\nV-Fly: WASD + Space + Boost Key\nF5: –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å GUI",
            Duration = 5
        })
    end)
    
    -- –ö–Ω–æ–ø–∫–∞ —Å–∫—Ä—ã—Ç–∏—è
    HideButton.MouseButton1Click:Connect(function()
        MainFrame.Visible = not MainFrame.Visible
        HideButton.Text = MainFrame.Visible and "üëÅÔ∏è –°–ö–†–´–¢–¨" or "üëÅÔ∏è –ü–û–ö–ê–ó–ê–¢–¨"
    end)
    
    -- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –æ–∫–Ω–∞
    local dragging = false
    local dragInput, dragStart, startPos
    
    TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    TitleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    -- –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è GUI
    wait(0.5)
    local success = pcall(loadSettings)
    if success then
        updateUIFromSettings()
    end
end

-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
UserInputService.InputBegan:Connect(ProcessKeybind)

LocalPlayer.CharacterAdded:Connect(function(character)
    wait(1)
    if character then
        UserRootPart = character:WaitForChild("HumanoidRootPart")
    end
end)

if LocalPlayer.Character then
    UserRootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
end

-- –°–æ–∑–¥–∞–µ–º GUI
CreateGUI()

-- –ö–ª–∞–≤–∏—à–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è GUI (F5)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.F5 then
        if ScreenGui then
            MainFrame.Visible = not MainFrame.Visible
        else
            CreateGUI()
        end
    end
end)
