local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")

-- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
local player = Players.LocalPlayer
local camera = workspace.CurrentCamera
local humanoid = nil
local settings = {
    Speed = 16,
    JumpHeight = 50,
    FOV = 70
}
local dragging = false
local dragStart, startPos
local enabled = true
local connections = {}
local saveFileName = "1qluaseting/LooPMenuSP.json"
local isMinimized = false

-- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–æ–≤
local activeSlider = nil
local sliding = false
local isMouseButtonDown = false

-- –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
local function ensureSettingsFolder()
    if not isfolder("1qluaseting") then
        makefolder("1qluaseting")
    end
end

-- –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
local function saveSettings()
    ensureSettingsFolder()
    
    local success, result = pcall(function()
        local jsonData = HttpService:JSONEncode(settings)
        writefile(saveFileName, jsonData)
        return true
    end)
    
    if success then
        if SaveButton then
            SaveButton.Text = "‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!"
            task.wait(0.8)
            SaveButton.Text = "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
        end
        return true
    else
        return false
    end
end

-- –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ JSON
local function loadSettings()
    ensureSettingsFolder()
    
    if not isfile(saveFileName) then
        return false
    end
    
    local success, result = pcall(function()
        local jsonData = readfile(saveFileName)
        local loadedSettings = HttpService:JSONDecode(jsonData)
        
        settings.Speed = tonumber(loadedSettings.Speed) or 16
        settings.JumpHeight = tonumber(loadedSettings.JumpHeight) or 50
        settings.FOV = tonumber(loadedSettings.FOV) or 70
        
        return true
    end)
    
    if success then
        if LoadButton then
            LoadButton.Text = "‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ!"
            task.wait(0.8)
            LoadButton.Text = "üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å"
        end
        return true
    else
        return false
    end
end

-- –°–æ–∑–¥–∞–µ–º GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "LooPMenuSP"
ScreenGui.DisplayOrder = 999
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- –ì–ª–∞–≤–Ω—ã–π —Ñ—Ä–µ–π–º (394x331)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 394, 0, 331)
MainFrame.Position = UDim2.new(0.146, 0, 0.3, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.BackgroundTransparency = 0
MainFrame.BorderSizePixel = 0
MainFrame.Active = true

-- –ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –æ–∫–Ω–∞
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

-- –¢–µ–Ω—å –¥–ª—è –æ–∫–Ω–∞
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(40, 40, 40)
UIStroke.Thickness = 2
UIStroke.Parent = MainFrame

-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å (394x50)
local TopBar = Instance.new("Frame")
TopBar.Name = "TopBar"
TopBar.Size = UDim2.new(1, 0, 0, 50)
TopBar.Position = UDim2.new(0, 0, 0, 0)
TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
TopBar.BackgroundTransparency = 0
TopBar.BorderSizePixel = 0

-- –ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏
local TopBarCorner = Instance.new("UICorner")
TopBarCorner.CornerRadius = UDim.new(0, 8)
TopBarCorner.Parent = TopBar

-- –ò–∫–æ–Ω–∫–∞
local Icon = Instance.new("ImageLabel")
Icon.Name = "Icon"
Icon.Size = UDim2.new(0, 22, 0, 22)
Icon.Position = UDim2.new(0, 15, 0.5, -11)
Icon.BackgroundTransparency = 1
Icon.Image = "rbxassetid://7733774602"
Icon.ImageColor3 = Color3.fromRGB(253, 104, 159)

-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–æ–ª–æ—Å–∫–∞
local DecorativeLine = Instance.new("Frame")
DecorativeLine.Name = "DecorativeLine"
DecorativeLine.Size = UDim2.new(0, 2, 0, 16)
DecorativeLine.Position = UDim2.new(0, 45, 0.5, -8)
DecorativeLine.BackgroundColor3 = Color3.fromRGB(253, 104, 159)
DecorativeLine.BorderSizePixel = 0
local DecorativeCorner = Instance.new("UICorner")
DecorativeCorner.CornerRadius = UDim.new(0, 1)
DecorativeCorner.Parent = DecorativeLine

-- –ó–∞–≥–æ–ª–æ–≤–æ–∫
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, -100, 1, 0)
Title.Position = UDim2.new(0, 60, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "LocalPlayer Menu"
Title.TextColor3 = Color3.fromRGB(253, 104, 159)
Title.TextSize = 26
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left

-- –ö–Ω–æ–ø–∫–∞ "–°–≤–µ—Ä–Ω—É—Ç—å"
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -70, 0, 10)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
MinimizeButton.Text = "-"
MinimizeButton.TextColor3 = Color3.fromRGB(253, 104, 159)
MinimizeButton.TextSize = 22
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.ZIndex = 2

local MinimizeCorner = Instance.new("UICorner")
MinimizeCorner.CornerRadius = UDim.new(0, 6)
MinimizeCorner.Parent = MinimizeButton

local MinimizeStroke = Instance.new("UIStroke")
MinimizeStroke.Color = Color3.fromRGB(60, 60, 60)
MinimizeStroke.Thickness = 1
MinimizeStroke.Parent = MinimizeButton

local MinimizeImageButton = Instance.new("ImageButton")
MinimizeImageButton.Name = "MinimizeImageButton"
MinimizeImageButton.Size = UDim2.new(1, 0, 1, 0)
MinimizeImageButton.Position = UDim2.new(0, 0, 0, 0)
MinimizeImageButton.BackgroundTransparency = 1
MinimizeImageButton.Image = ""
MinimizeImageButton.ZIndex = 3

-- –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫—Ä—ã—Ç—å"
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30) 
CloseButton.Position = UDim2.new(1, -35, 0, 10)
CloseButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
CloseButton.Text = "√ó"
CloseButton.TextColor3 = Color3.fromRGB(253, 104, 159)
CloseButton.TextSize = 24
CloseButton.Font = Enum.Font.GothamBold
CloseButton.ZIndex = 2

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

local CloseStroke = Instance.new("UIStroke")
CloseStroke.Color = Color3.fromRGB(60, 60, 60)
CloseStroke.Thickness = 1
CloseStroke.Parent = CloseButton

local CloseImageButton = Instance.new("ImageButton") 
CloseImageButton.Name = "CloseImageButton"
CloseImageButton.Size = UDim2.new(1, 0, 1, 0)
CloseImageButton.Position = UDim2.new(0, 0, 0, 0)
CloseImageButton.BackgroundTransparency = 1
CloseImageButton.Image = ""
CloseImageButton.ZIndex = 3

-- –ö–æ–Ω—Ç–µ–Ω—Ç–Ω–∞—è –æ–±–ª–∞—Å—Ç—å
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, 0, 1, -50)
ContentFrame.Position = UDim2.new(0, 0, 0, 50)
ContentFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
ContentFrame.BackgroundTransparency = 0
ContentFrame.BorderSizePixel = 0
ContentFrame.ClipsDescendants = true

-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
local SettingsContainer = Instance.new("ScrollingFrame")
SettingsContainer.Name = "SettingsContainer"
SettingsContainer.Size = UDim2.new(1, -20, 0, 200)
SettingsContainer.Position = UDim2.new(0, 10, 0, 10)
SettingsContainer.BackgroundTransparency = 1
SettingsContainer.ScrollBarThickness = 0
SettingsContainer.CanvasSize = UDim2.new(0, 0, 0, 210)
SettingsContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y

-- –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
local function createSetting(parent, name, yPosition, minValue, maxValue, defaultValue, color)
    local frame = Instance.new("Frame")
    frame.Name = name .. "Frame"
    frame.Size = UDim2.new(1, 0, 0, 70)
    frame.Position = UDim2.new(0, 0, 0, yPosition)
    frame.BackgroundTransparency = 1
    
    local label = Instance.new("TextLabel")
    label.Name = name .. "Label"
    label.Size = UDim2.new(0.7, 0, 0, 22)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = name .. ":"
    label.TextColor3 = Color3.fromRGB(180, 180, 180)
    label.TextSize = 16
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Name = name .. "Value"
    valueLabel.Size = UDim2.new(0.3, -5, 0, 22)
    valueLabel.Position = UDim2.new(0.7, 5, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(defaultValue)
    valueLabel.TextColor3 = Color3.fromRGB(253, 104, 159)
    valueLabel.TextSize = 16
    valueLabel.Font = Enum.Font.GothamBold
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    
    local sliderBackground = Instance.new("Frame")
    sliderBackground.Name = name .. "SliderBg"
    sliderBackground.Size = UDim2.new(1, 0, 0, 6)
    sliderBackground.Position = UDim2.new(0, 0, 0, 30)
    sliderBackground.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    sliderBackground.BorderSizePixel = 0
    
    local sliderCorner = Instance.new("UICorner")
    sliderCorner.CornerRadius = UDim.new(0, 3)
    sliderCorner.Parent = sliderBackground
    
    local slider = Instance.new("Frame")
    slider.Name = name .. "Slider"
    slider.Size = UDim2.new(1, 0, 0, 25)
    slider.Position = UDim2.new(0, 0, 0, 25)
    slider.BackgroundTransparency = 1
    
    local fill = Instance.new("Frame")
    fill.Name = name .. "Fill"
    fill.Size = UDim2.new((defaultValue - minValue) / (maxValue - minValue), 0, 1, 0)
    fill.Position = UDim2.new(0, 0, 0, 0)
    fill.BackgroundColor3 = color
    fill.BorderSizePixel = 0
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0, 3)
    fillCorner.Parent = fill
    
    local sliderHandle = Instance.new("Frame")
    sliderHandle.Name = name .. "Handle"
    sliderHandle.Size = UDim2.new(0, 14, 0, 14)
    sliderHandle.Position = UDim2.new((defaultValue - minValue) / (maxValue - minValue), -7, 0.5, -7)
    sliderHandle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    sliderHandle.BorderSizePixel = 0
    sliderHandle.ZIndex = 2
    
    local handleCorner = Instance.new("UICorner")
    handleCorner.CornerRadius = UDim.new(1, 0)
    handleCorner.Parent = sliderHandle
    
    local textBox = Instance.new("TextBox")
    textBox.Name = name .. "Box"
    textBox.Size = UDim2.new(0.35, 0, 0, 28)
    textBox.Position = UDim2.new(0.65, 0, 0, 42)
    textBox.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    textBox.TextColor3 = Color3.fromRGB(230, 230, 230)
    textBox.PlaceholderColor3 = Color3.fromRGB(120, 120, 120)
    textBox.TextSize = 14
    textBox.PlaceholderText = "–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ"
    textBox.Text = tostring(defaultValue)
    textBox.ClearTextOnFocus = false
    textBox.Font = Enum.Font.Gotham
    
    local boxCorner = Instance.new("UICorner")
    boxCorner.CornerRadius = UDim.new(0, 6)
    boxCorner.Parent = textBox
    
    local boxStroke = Instance.new("UIStroke")
    boxStroke.Color = Color3.fromRGB(60, 60, 60)
    boxStroke.Thickness = 1
    boxStroke.Parent = textBox
    
    fill.Parent = sliderBackground
    sliderHandle.Parent = sliderBackground
    valueLabel.Parent = frame
    sliderBackground.Parent = frame
    textBox.Parent = frame
    label.Parent = frame
    frame.Parent = parent
    
    return frame, label, textBox, slider, fill, valueLabel, sliderBackground, sliderHandle
end

-- –°–æ–∑–¥–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
local SpeedFrame, SpeedLabel, SpeedBox, SpeedSlider, SpeedFill, SpeedValue, SpeedBg, SpeedHandle = createSetting(SettingsContainer, "–°–∫–æ—Ä–æ—Å—Ç—å", 0, 1, 100, 16, Color3.fromRGB(253, 104, 159))
local JumpFrame, JumpLabel, JumpBox, JumpSlider, JumpFill, JumpValue, JumpBg, JumpHandle = createSetting(SettingsContainer, "–ü—Ä—ã–∂–æ–∫", 75, 1, 100, 50, Color3.fromRGB(253, 104, 159))
local FOVFrame, FOVLabel, FOVBox, FOVSlider, FOVFill, FOVValue, FOVBg, FOVHandle = createSetting(SettingsContainer, "FOV", 150, 70, 150, 70, Color3.fromRGB(253, 104, 159))

-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
local ButtonsFrame = Instance.new("Frame")
ButtonsFrame.Name = "ButtonsFrame"
ButtonsFrame.Size = UDim2.new(1, -20, 0, 40)
ButtonsFrame.Position = UDim2.new(0, 10, 0, 220)
ButtonsFrame.BackgroundTransparency = 1

local SaveButton = Instance.new("TextButton")
SaveButton.Name = "SaveButton"
SaveButton.Size = UDim2.new(0.48, 0, 1, 0)
SaveButton.Position = UDim2.new(0, 0, 0, 0)
SaveButton.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
SaveButton.Text = "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
SaveButton.TextColor3 = Color3.fromRGB(230, 230, 230)
SaveButton.TextSize = 16
SaveButton.Font = Enum.Font.GothamBold

local SaveCorner = Instance.new("UICorner")
SaveCorner.CornerRadius = UDim.new(0, 6)
SaveCorner.Parent = SaveButton

local SaveStroke = Instance.new("UIStroke")
SaveStroke.Color = Color3.fromRGB(253, 104, 159)
SaveStroke.Thickness = 1
SaveStroke.Parent = SaveButton

local LoadButton = Instance.new("TextButton")
LoadButton.Name = "LoadButton"
LoadButton.Size = UDim2.new(0.48, 0, 1, 0)
LoadButton.Position = UDim2.new(0.52, 0, 0, 0)
LoadButton.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
LoadButton.Text = "üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å"
LoadButton.TextColor3 = Color3.fromRGB(230, 230, 230)
LoadButton.TextSize = 16
LoadButton.Font = Enum.Font.GothamBold

local LoadCorner = Instance.new("UICorner")
LoadCorner.CornerRadius = UDim.new(0, 6)
LoadCorner.Parent = LoadButton

local LoadStroke = Instance.new("UIStroke")
LoadStroke.Color = Color3.fromRGB(253, 104, 159)
LoadStroke.Thickness = 1
LoadStroke.Parent = LoadButton

-- –°—Ç–∞—Ç—É—Å –±–∞—Ä
local StatusBar = Instance.new("Frame")
StatusBar.Name = "StatusBar"
StatusBar.Size = UDim2.new(1, -20, 0, 30)
StatusBar.Position = UDim2.new(0, 10, 0, 270)
StatusBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
StatusBar.BorderSizePixel = 0

local StatusCorner = Instance.new("UICorner")
StatusCorner.CornerRadius = UDim.new(0, 6)
StatusCorner.Parent = StatusBar

local StatusText = Instance.new("TextLabel")
StatusText.Name = "StatusText"
StatusText.Size = UDim2.new(1, -10, 1, 0)
StatusText.Position = UDim2.new(0, 5, 0, 0)
StatusText.BackgroundTransparency = 1
StatusText.Text = "–ì–æ—Ç–æ–≤–æ. –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∑–∞ –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å"
StatusText.TextColor3 = Color3.fromRGB(150, 150, 150)
StatusText.TextSize = 12
StatusText.Font = Enum.Font.Gotham
StatusText.TextXAlignment = Enum.TextXAlignment.Left
StatusText.Parent = StatusBar

-- –°–æ–±–∏—Ä–∞–µ–º GUI
MinimizeImageButton.Parent = MinimizeButton
CloseImageButton.Parent = CloseButton
Icon.Parent = TopBar
DecorativeLine.Parent = TopBar
Title.Parent = TopBar
MinimizeButton.Parent = TopBar
CloseButton.Parent = TopBar
TopBar.Parent = MainFrame

StatusBar.Parent = ContentFrame
LoadButton.Parent = ButtonsFrame
SaveButton.Parent = ButtonsFrame
ButtonsFrame.Parent = ContentFrame
SettingsContainer.Parent = ContentFrame
ContentFrame.Parent = MainFrame
MainFrame.Parent = ScreenGui

-- –§—É–Ω–∫—Ü–∏—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
local function toggleMinimize()
    isMinimized = not isMinimized
    
    if isMinimized then
        ContentFrame.Visible = false
        MainFrame.Size = UDim2.new(0, 394, 0, 50)
        MinimizeButton.Text = "+"
        StatusText.Text = "–û–∫–Ω–æ —Å–≤–µ—Ä–Ω—É—Ç–æ"
    else
        ContentFrame.Visible = true
        MainFrame.Size = UDim2.new(0, 394, 0, 331)
        MinimizeButton.Text = "-"
        StatusText.Text = "–ì–æ—Ç–æ–≤–æ. –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∑–∞ –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å"
    end
end

-- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è GUI
local function startDragging(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        StatusText.Text = "–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ..."
    end
end

local function stopDragging(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
        StatusText.Text = "–ì–æ—Ç–æ–≤–æ"
    end
end

-- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
TopBar.InputBegan:Connect(startDragging)
TopBar.InputEnded:Connect(stopDragging)
Title.InputBegan:Connect(startDragging)
Title.InputEnded:Connect(stopDragging)
Icon.InputBegan:Connect(startDragging)
Icon.InputEnded:Connect(stopDragging)

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–æ–≤
local function handleGlobalMouseMove(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        -- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ GUI
        if dragging and dragStart and startPos then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(
                startPos.X.Scale, 
                startPos.X.Offset + delta.X,
                startPos.Y.Scale, 
                startPos.Y.Offset + delta.Y
            )
        end
        
        -- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–∞–π–¥–µ—Ä–æ–≤, –¥–∞–∂–µ –µ—Å–ª–∏ –º—ã—à—å –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏
        if sliding and activeSlider and isMouseButtonDown then
            local mousePos = input.Position.X
            local sliderAbsPos = activeSlider.bg.AbsolutePosition.X
            local sliderWidth = activeSlider.bg.AbsoluteSize.X
            
            -- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å–ª–∞–π–¥–µ—Ä–∞
            local relativeX = math.clamp(mousePos - sliderAbsPos, 0, sliderWidth)
            local percent = relativeX / sliderWidth
            local value = math.floor(activeSlider.min + (activeSlider.max - activeSlider.min) * percent + 0.5)
            value = math.clamp(value, activeSlider.min, activeSlider.max)
            
            if activeSlider.callback then
                activeSlider.callback(value)
            end
        end
    end
end

UserInputService.InputChanged:Connect(handleGlobalMouseMove)

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
local function updateUI()
    SpeedBox.Text = tostring(settings.Speed)
    JumpBox.Text = tostring(settings.JumpHeight)
    FOVBox.Text = tostring(settings.FOV)
    
    SpeedValue.Text = tostring(settings.Speed)
    JumpValue.Text = tostring(settings.JumpHeight)
    FOVValue.Text = tostring(settings.FOV)
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–∞–π–¥–µ—Ä—ã –∏ —Ä—É—á–∫–∏
    local speedPercent = (settings.Speed - 1) / 99
    local jumpPercent = (settings.JumpHeight - 1) / 99
    local fovPercent = (settings.FOV - 70) / 80
    
    SpeedFill.Size = UDim2.new(speedPercent, 0, 1, 0)
    SpeedHandle.Position = UDim2.new(speedPercent, -7, 0.5, -7)
    
    JumpFill.Size = UDim2.new(jumpPercent, 0, 1, 0)
    JumpHandle.Position = UDim2.new(jumpPercent, -7, 0.5, -7)
    
    FOVFill.Size = UDim2.new(fovPercent, 0, 1, 0)
    FOVHandle.Position = UDim2.new(fovPercent, -7, 0.5, -7)
end

-- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫ –∏–≥—Ä–æ–∫—É
local function applySettings()
    if not enabled then return end
    
    -- –ü—Ä–∏–º–µ–Ω—è–µ–º FOV –∫ –∫–∞–º–µ—Ä–µ
    if camera then
        camera.FieldOfView = settings.FOV
    end
    
    -- –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –ø—Ä—ã–∂–æ–∫ –∫ –ø–µ—Ä—Å–æ–Ω–∞–∂—É
    if player.Character then
        local charHumanoid = player.Character:FindFirstChildOfClass("Humanoid")
        if charHumanoid then
            humanoid = charHumanoid
            
            -- –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
            humanoid.WalkSpeed = settings.Speed
            
            -- –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—ã—Å–æ—Ç—É –ø—Ä—ã–∂–∫–∞
            humanoid.JumpHeight = settings.JumpHeight
            
            -- –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ç–∞–∫–∂–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º JumpPower
            if humanoid:GetPropertyChangedSignal("JumpPower") then
                humanoid.JumpPower = settings.JumpHeight * 0.144
            end
        end
    end
end

-- –§—É–Ω–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–∞–π–¥–µ—Ä–∞ —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º
local function setupSlider(slider, fill, valueLabel, bg, handle, minVal, maxVal, callback)
    local sliderData = {
        bg = bg,
        min = minVal,
        max = maxVal,
        callback = callback,
        fill = fill,
        valueLabel = valueLabel,
        handle = handle
    }
    
    local function startSliding()
        sliding = true
        activeSlider = sliderData
        isMouseButtonDown = true
        StatusText.Text = "–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è..."
    end
    
    local function stopSliding()
        sliding = false
        activeSlider = nil
        isMouseButtonDown = false
        StatusText.Text = "–ì–æ—Ç–æ–≤–æ"
    end
    
    -- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
    local function onSliderInputBegan(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            startSliding()
            -- –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é
            local mousePos = input.Position.X
            local sliderAbsPos = bg.AbsolutePosition.X
            local sliderWidth = bg.AbsoluteSize.X
            
            local relativeX = math.clamp(mousePos - sliderAbsPos, 0, sliderWidth)
            local percent = relativeX / sliderWidth
            local value = math.floor(minVal + (maxVal - minVal) * percent + 0.5)
            value = math.clamp(value, minVal, maxVal)
            
            if callback then
                callback(value)
            end
        end
    end
    
    -- –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ª–∞–π–¥–µ—Ä–∞
    slider.InputBegan:Connect(onSliderInputBegan)
    bg.InputBegan:Connect(onSliderInputBegan)
    handle.InputBegan:Connect(onSliderInputBegan)
    
    -- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–∞–π–¥–µ—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è
    local function updateSlider(value)
        local percent = (value - minVal) / (maxVal - minVal)
        percent = math.clamp(percent, 0, 1)
        fill.Size = UDim2.new(percent, 0, 1, 0)
        handle.Position = UDim2.new(percent, -7, 0.5, -7)
        if valueLabel then
            valueLabel.Text = tostring(value)
        end
    end
    
    -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ª–∞–π–¥–µ—Ä–∞
    return updateSlider
end

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª–∞–π–¥–µ—Ä–æ–≤
local updateSpeedSlider = setupSlider(SpeedSlider, SpeedFill, SpeedValue, SpeedBg, SpeedHandle, 1, 100, function(value)
    settings.Speed = value
    updateUI()
    applySettings()
end)

local updateJumpSlider = setupSlider(JumpSlider, JumpFill, JumpValue, JumpBg, JumpHandle, 1, 100, function(value)
    settings.JumpHeight = value
    updateUI()
    applySettings()
end)

local updateFOVSlider = setupSlider(FOVSlider, FOVFill, FOVValue, FOVBg, FOVHandle, 70, 150, function(value)
    settings.FOV = value
    updateUI()
    applySettings()
end)

-- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π —Ñ–æ–∫—É—Å–∞
local function setupTextBox(textBox, updateFunction, minVal, maxVal)
    textBox.Focused:Connect(function()
        textBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        textBox.UIStroke.Color = Color3.fromRGB(253, 104, 159)
    end)
    
    textBox.FocusLost:Connect(function(enterPressed)
        textBox.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
        textBox.UIStroke.Color = Color3.fromRGB(60, 60, 60)
        
        local value = tonumber(textBox.Text)
        if value then
            value = math.clamp(value, minVal, maxVal)
            updateFunction(value)
        else
            -- –ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ –Ω–µ —á–∏—Å–ª–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            if updateFunction == updateSpeedSlider then
                textBox.Text = tostring(settings.Speed)
            elseif updateFunction == updateJumpSlider then
                textBox.Text = tostring(settings.JumpHeight)
            elseif updateFunction == updateFOVSlider then
                textBox.Text = tostring(settings.FOV)
            end
        end
    end)
end

setupTextBox(SpeedBox, function(value)
    settings.Speed = value
    updateSpeedSlider(settings.Speed)
    updateUI()
    applySettings()
end, 1, 100)

setupTextBox(JumpBox, function(value)
    settings.JumpHeight = value
    updateJumpSlider(settings.JumpHeight)
    updateUI()
    applySettings()
end, 1, 100)

setupTextBox(FOVBox, function(value)
    settings.FOV = value
    updateFOVSlider(settings.FOV)
    updateUI()
    applySettings()
end, 70, 150)

-- –ö–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
local function setupButton(button)
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end)
    
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    end)
    
    button.MouseButton1Down:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    end)
    
    button.MouseButton1Up:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end)
end

setupButton(SaveButton)
setupButton(LoadButton)
setupButton(MinimizeButton)
setupButton(CloseButton)

-- –ö–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏
SaveButton.MouseButton1Click:Connect(function()
    if saveSettings() then
        StatusText.Text = "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ JSON"
    else
        StatusText.Text = "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"
    end
end)

LoadButton.MouseButton1Click:Connect(function()
    if loadSettings() then
        updateSpeedSlider(settings.Speed)
        updateJumpSlider(settings.JumpHeight)
        updateFOVSlider(settings.FOV)
        updateUI()
        applySettings()
        StatusText.Text = "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ JSON"
    else
        StatusText.Text = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"
    end
end)

-- –ö–Ω–æ–ø–∫–∞ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
MinimizeButton.MouseButton1Click:Connect(toggleMinimize)
MinimizeImageButton.MouseButton1Click:Connect(toggleMinimize)

-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
CloseButton.MouseButton1Click:Connect(function()
    enabled = false
    
    -- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    if humanoid then
        humanoid.WalkSpeed = 16
        humanoid.JumpHeight = 50
        if humanoid:GetPropertyChangedSignal("JumpPower") then
            humanoid.JumpPower = 50 * 0.144
        end
    end
    if camera then
        camera.FieldOfView = 70
    end
    
    -- –ü–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
    local tween = TweenService:Create(MainFrame, TweenInfo.new(0.3), {BackgroundTransparency = 1})
    tween:Play()
    tween.Completed:Wait()
    
    -- –£–¥–∞–ª—è–µ–º GUI
    ScreenGui:Destroy()
    
    -- –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    for _, connection in pairs(connections) do
        if connection then
            pcall(function() connection:Disconnect() end)
        end
    end
end)

CloseImageButton.MouseButton1Click:Connect(function()
    CloseButton.MouseButton1Click:Fire()
end)

-- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –º—ã—à–∏
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
        sliding = false
        activeSlider = nil
        isMouseButtonDown = false
        StatusText.Text = "–ì–æ—Ç–æ–≤–æ"
    end
end)

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–µ—Ä–∏ —Ñ–æ–∫—É—Å–∞ –æ–∫–Ω–∞
UserInputService.WindowFocusReleased:Connect(function()
    dragging = false
    sliding = false
    activeSlider = nil
    isMouseButtonDown = false
    StatusText.Text = "–û–∫–Ω–æ –ø–æ—Ç–µ—Ä—è–ª–æ —Ñ–æ–∫—É—Å"
end)

-- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
connections.heartbeat = RunService.Heartbeat:Connect(function()
    if enabled then
        applySettings()
    end
end)

-- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
connections.character = player.CharacterAdded:Connect(function()
    task.wait(1) -- –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    if enabled then
        applySettings()
    end
end)

-- –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
task.spawn(function()
    task.wait(1)
    if loadSettings() then
        updateSpeedSlider(settings.Speed)
        updateJumpSlider(settings.JumpHeight)
        updateFOVSlider(settings.FOV)
        updateUI()
        StatusText.Text = "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã"
    end
    applySettings()
end)

-- –î–æ–±–∞–≤–ª—è–µ–º GUI –≤ CoreGui
if CoreGui:FindFirstChild("LooPMenuSP") then
    CoreGui:FindFirstChild("LooPMenuSP"):Destroy()
end
ScreenGui.Parent = CoreGui

-- –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
connections.inputBegan = UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.RightControl then
        MainFrame.Visible = not MainFrame.Visible
    end
end)

-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
updateUI()
applySettings()

-- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä –∫–∞–Ω–≤–∞—Å–∞
SettingsContainer:GetPropertyChangedSignal("AbsoluteCanvasSize"):Connect(function()
    SettingsContainer.CanvasSize = UDim2.new(0, 0, 0, SettingsContainer.AbsoluteCanvasSize.Y)
end)
