-- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
_G.TeleportScript = _G.TeleportScript or {}
local TeleportScript = _G.TeleportScript

-- –°–µ—Ä–≤–∏—Å—ã
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏
TeleportScript.Enabled = true
TeleportScript.BackwardOffset = 2 -- –û—Ç—Å—Ç—É–ø –æ—Ç –∏–≥—Ä–æ–∫–∞
TeleportScript.TargetSwitchTime = 10 -- –í—Ä–µ–º—è –¥–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–º–µ–Ω—ã —Ü–µ–ª–∏ (–µ—Å–ª–∏ —Ü–µ–ª—å –Ω–µ —É–º–µ—Ä–ª–∞)
TeleportScript.RandomSwitchInterval = 2 -- –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–ª—É—á–∞–π–Ω–æ–π —Å–º–µ–Ω—ã —Ü–µ–ª–∏ (—Å–µ–∫—É–Ω–¥—ã)
TeleportScript.CurrentTarget = nil
TeleportScript.LastTargetChange = 0
TeleportScript.LastRandomSwitch = 0
TeleportScript.Connection = nil
TeleportScript.CharacterConnection = nil

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∞—à–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
function TeleportScript:CheckLocalPlayerAlive()
    if not LocalPlayer.Character then return false end
    local humanoid = LocalPlayer.Character:FindFirstChild("Humanoid")
    return humanoid and humanoid.Health > 0
end

-- –ü–æ–∏—Å–∫ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∂–∏–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–≤–º–µ—Å—Ç–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ)
function TeleportScript:GetRandomPlayer()
    if not self:CheckLocalPlayerAlive() then return nil end
    
    local alivePlayers = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local humanoid = player.Character:FindFirstChild("Humanoid")
            if humanoid and humanoid.Health > 0 then
                table.insert(alivePlayers, player)
            end
        end
    end
    
    if #alivePlayers > 0 then
        return alivePlayers[math.random(1, #alivePlayers)]
    end
    return nil
end

-- –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è —Å –æ—Ç—Å—Ç—É–ø–æ–º –Ω–∞–∑–∞–¥
function TeleportScript:TeleportToPlayer(player)
    if not player or not player.Character or not self:CheckLocalPlayerAlive() then return false end
    
    local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end
    
    local targetCFrame = humanoidRootPart.CFrame
    local lookVector = targetCFrame.LookVector
    local offsetPosition = targetCFrame.Position - (lookVector * self.BackwardOffset)
    
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(offsetPosition, targetCFrame.Position)
        return true
    end
    return false
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–º–µ–Ω—ã —Ü–µ–ª–∏
function TeleportScript:ShouldSwitchTarget()
    local currentTime = os.time()
    
    -- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ –∫–∞–∂–¥—ã–µ RandomSwitchInterval —Å–µ–∫—É–Ω–¥
    if currentTime - self.LastRandomSwitch >= self.RandomSwitchInterval then
        self.LastRandomSwitch = currentTime
        return true
    end
    
    -- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    if not self:CheckLocalPlayerAlive() then return true end
    if not self.CurrentTarget then return true end
    
    local character = self.CurrentTarget.Character
    if not character then return true end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return true end
    if currentTime - self.LastTargetChange >= self.TargetSwitchTime then return true end
    
    return false
end

-- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
function TeleportScript:Update()
    if not self.Enabled then return end
    
    if not self:CheckLocalPlayerAlive() then
        if self.CurrentTarget then
            self.CurrentTarget = nil
        end
        return
    end
    
    if self:ShouldSwitchTarget() then
        self.CurrentTarget = self:GetRandomPlayer() -- –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        self.LastTargetChange = os.time()
    end
    
    if self.CurrentTarget then
        self:TeleportToPlayer(self.CurrentTarget)
    end
end

-- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–º–µ—Ä—Ç–∏ –≤–∞—à–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
function TeleportScript:TrackCharacter()
    if self.CharacterConnection then
        self.CharacterConnection:Disconnect()
    end
    
    self.CharacterConnection = LocalPlayer.CharacterAdded:Connect(function(character)
        self.CurrentTarget = nil
        self.LastTargetChange = 0
        self.LastRandomSwitch = 0
    end)
end

-- –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
function TeleportScript:Start()
    if self.Connection then
        self.Connection:Disconnect()
    end
    
    self:TrackCharacter()
    self.Connection = RunService.Heartbeat:Connect(function()
        self:Update()
    end)
    self.Enabled = true
    print("‚úÖ –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!")
    print("üîÅ –ê–≤—Ç–æ—Å–º–µ–Ω–∞ —Ü–µ–ª–∏ –∫–∞–∂–¥—ã–µ " .. self.RandomSwitchInterval .. " —Å–µ–∫—É–Ω–¥")
end

-- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞
function TeleportScript:Stop()
    if self.Connection then
        self.Connection:Disconnect()
        self.Connection = nil
    end
    if self.CharacterConnection then
        self.CharacterConnection:Disconnect()
        self.CharacterConnection = nil
    end
    self.Enabled = false
    print("‚õî –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞!")
end

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —Å–º–µ–Ω—ã —Ü–µ–ª–∏ (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤—Ä—É—á–Ω—É—é)
function TeleportScript:SetSwitchInterval(seconds)
    self.RandomSwitchInterval = seconds
    print("üïí –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–º–µ–Ω—ã —Ü–µ–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " .. seconds .. " —Å–µ–∫")
end

-- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ
TeleportScript:Start()

-- –ü—Ä–∏–º–µ—Ä: –∏–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–º–µ–Ω—ã —Ü–µ–ª–∏ –Ω–∞ 15 —Å–µ–∫—É–Ω–¥
-- TeleportScript:SetSwitchInterval(15)
